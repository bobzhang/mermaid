///|
fn default_ascii_options(
  use_ascii : Bool,
) -> @beautiful_mermaid.AsciiRenderOptions {
  { use_ascii, padding_x: 5, padding_y: 5, box_border_padding: 1 }
}

///|
fn assert_text_parity(
  input : String,
  expected_ascii : String,
  expected_unicode : String,
) -> Unit raise {
  let actual_ascii = @beautiful_mermaid.render_mermaid_ascii(
    input,
    options=default_ascii_options(true),
  )
  let actual_unicode = @beautiful_mermaid.render_mermaid_ascii(
    input,
    options=default_ascii_options(false),
  )

  assert_eq(
    ts_normalize_whitespace(actual_ascii),
    ts_normalize_whitespace(expected_ascii),
  )
  assert_eq(
    ts_normalize_whitespace(actual_unicode),
    ts_normalize_whitespace(expected_unicode),
  )
}

///|
fn beautiful_mermaid_source() -> String {
  (
    #|stateDiagram-v2
    #|    direction LR
    #|    [*] --> Input
    #|    Input --> Parse: DSL
    #|    Parse --> Layout: AST
    #|    Layout --> SVG: Vector
    #|    Layout --> ASCII: Text
    #|    SVG --> Theme
    #|    ASCII --> Theme
    #|    Theme --> Output
    #|    Output --> [*]
  )
}

///|
fn beautiful_mermaid_expected_ascii() -> String {
  (
    #|+--+     +-------+     +-------+     +--------+        +-------+     +-------+     +--------+     +--+
    #||  |     |       |     |       |     |        |        |       |     |       |     |        |     |  |
    #||  |---->| Input |-DSL>| Parse |-AST>| Layout |Vector->|  SVG  |---->| Theme |---->| Output |---->|  |
    #||  |     |       |     |       |     |        |        |       |     |       |     |        |     |  |
    #|+--+     +-------+     +-------+     +--------+        +-------+     +-------+     +--------+     +--+
    #|                                          |                              ^
    #|                                          |                              |
    #|                                          |                              |
    #|                                        Text                             |
    #|                                          |                              |
    #|                                          |            +-------+         |
    #|                                          |            |       |         |
    #|                                          +----------->| ASCII |---------+
    #|                                                       |       |
    #|                                                       +-------+
  )
}

///|
fn beautiful_mermaid_expected_unicode() -> String {
  (
    #|┌──┐     ┌───────┐     ┌───────┐     ┌────────┐        ┌───────┐     ┌───────┐     ┌────────┐     ┌──┐
    #|│  │     │       │     │       │     │        │        │       │     │       │     │        │     │  │
    #|│  ├────►│ Input ├─DSL►│ Parse ├─AST►│ Layout ├Vector─►│  SVG  ├────►│ Theme ├────►│ Output ├────►│  │
    #|│  │     │       │     │       │     │        │        │       │     │       │     │        │     │  │
    #|└──┘     └───────┘     └───────┘     └────┬───┘        └───────┘     └───────┘     └────────┘     └──┘
    #|                                          │                              ▲
    #|                                          │                              │
    #|                                          │                              │
    #|                                        Text                             │
    #|                                          │                              │
    #|                                          │            ┌───────┐         │
    #|                                          │            │       │         │
    #|                                          └───────────►│ ASCII ├─────────┘
    #|                                                       │       │
    #|                                                       └───────┘
  )
}

///|
fn git_branching_workflow_source() -> String {
  (
    #|graph LR
    #|  A[main] --> B[develop]
    #|  B --> C[feature/auth]
    #|  B --> D[feature/ui]
    #|  C --> E{PR Review}
    #|  D --> E
    #|  E -->|approved| B
    #|  B --> F[release/1.0]
    #|  F --> G{Tests?}
    #|  G -->|pass| A
    #|  G -->|fail| F
  )
}

///|
fn git_branching_workflow_expected_ascii() -> String {
  (
    #|+------+     +---------+     +--------------+     +-----------+
    #||      |     |         |     |              |     |           |
    #|| main |---->| develop |---->| feature/auth |---->| PR Review |
    #||      |     |         |     |              |     |           |
    #|+------+     +---------+     +--------------+     +-----------+
    #|    ^             ^                                 approved
    #|    |             |                                     |
    #|    |             +-------------------------------------+
    #|    |             |                                     |
    #|    +-------------+----------------------------+        |
    #|                  |          +--------------+  |  +-----------+
    #|                  |          |              |  |  |           |
    #|                  +--------->|  feature/ui  |-fail|   Tests?  |
    #|                  |          |              |  |  |           |
    #|                  |          +--------------+  |  +-----------+
    #|                  |                            |        ^
    #|                  |                            |        |
    #|                  |                  +---------+        |
    #|                  |                  |                  |
    #|                  |                  v                  |
    #|                  |          +--------------+           |
    #|                  |          |              |           |
    #|                  +--------->| release/1.0  |-----------+
    #|                             |              |
    #|                             +--------------+
  )
}

///|
fn git_branching_workflow_expected_unicode() -> String {
  (
    #|┌──────┐     ┌─────────┐     ┌──────────────┐     ┌───────────┐
    #|│      │     │         │     │              │     │           │
    #|│ main ├────►│ develop ├────►│ feature/auth ├────►│ PR Review │
    #|│      │     │         │     │              │     │           │
    #|└──────┘     └────┬────┘     └──────────────┘     └─────┬─────┘
    #|    ▲             ▲                                 approved
    #|    │             │                                     │
    #|    │             ├─────────────────────────────────────┤
    #|    │             │                                     │
    #|    └─────────────┼────────────────────────────┐        │
    #|                  │          ┌──────────────┐  │  ┌───────────┐
    #|                  │          │              │  │  │           │
    #|                  ├─────────►│  feature/ui  ├─fail┤   Tests?  │
    #|                  │          │              │  │  │           │
    #|                  │          └──────────────┘  │  └───────────┘
    #|                  │                            │        ▲
    #|                  │                            │        │
    #|                  │                  ┌─────────┘        │
    #|                  │                  │                  │
    #|                  │                  ▼                  │
    #|                  │          ┌──────────────┐           │
    #|                  │          │              │           │
    #|                  └─────────►│ release/1.0  ├───────────┘
    #|                             │              │
    #|                             └──────────────┘
  )
}

///|
fn subgraph_direction_override_source() -> String {
  (
    #|graph TD
    #|  subgraph pipeline [Processing Pipeline]
    #|    direction LR
    #|    A[Input] --> B[Parse] --> C[Transform] --> D[Output]
    #|  end
    #|  E[Source] --> A
    #|  D --> F[Sink]
  )
}

///|
fn subgraph_direction_override_expected_ascii() -> String {
  (
    #|+---------------+
    #||Processing Pipe|
    #||               |
    #||               |
    #|| +-----------+ |   +--------+
    #|| |           | |   |        |
    #|| |   Input   |<----| Source |
    #|| |           | |   |        |
    #|| +-----------+ |   +--------+
    #||       |       |
    #||       |       |
    #||       |       |
    #||       |       |
    #||       v       |
    #|| +-----------+ |
    #|| |           | |
    #|| |   Parse   | |
    #|| |           | |
    #|| +-----------+ |
    #||       |       |
    #||       |       |
    #||       |       |
    #||       |       |
    #||       v       |
    #|| +-----------+ |
    #|| |           | |
    #|| | Transform | |
    #|| |           | |
    #|| +-----------+ |
    #||       |       |
    #||       |       |
    #||       |       |
    #||       |       |
    #||       v       |
    #|| +-----------+ |
    #|| |           | |
    #|| |   Output  | |
    #|| |           | |
    #|| +-----------+ |
    #||       |       |
    #|+-------|-------+
    #|        |
    #|        |
    #|        v
    #|  +-----------+
    #|  |           |
    #|  |    Sink   |
    #|  |           |
    #|  +-----------+
  )
}

///|
fn subgraph_direction_override_expected_unicode() -> String {
  (
    #|┌───────────────┐
    #|│Processing Pipe│
    #|│               │
    #|│               │
    #|│ ┌───────────┐ │   ┌────────┐
    #|│ │           │ │   │        │
    #|│ │   Input   │◄┼───┤ Source │
    #|│ │           │ │   │        │
    #|│ └─────┬─────┘ │   └────────┘
    #|│       │       │
    #|│       │       │
    #|│       │       │
    #|│       │       │
    #|│       ▼       │
    #|│ ┌───────────┐ │
    #|│ │           │ │
    #|│ │   Parse   │ │
    #|│ │           │ │
    #|│ └─────┬─────┘ │
    #|│       │       │
    #|│       │       │
    #|│       │       │
    #|│       │       │
    #|│       ▼       │
    #|│ ┌───────────┐ │
    #|│ │           │ │
    #|│ │ Transform │ │
    #|│ │           │ │
    #|│ └─────┬─────┘ │
    #|│       │       │
    #|│       │       │
    #|│       │       │
    #|│       │       │
    #|│       ▼       │
    #|│ ┌───────────┐ │
    #|│ │           │ │
    #|│ │   Output  │ │
    #|│ │           │ │
    #|│ └─────┬─────┘ │
    #|│       │       │
    #|└───────┼───────┘
    #|        │
    #|        │
    #|        ▼
    #|  ┌───────────┐
    #|  │           │
    #|  │    Sink   │
    #|  │           │
    #|  └───────────┘
  )
}

///|
fn ci_cd_pipeline_source() -> String {
  (
    #|graph TD
    #|  subgraph ci [CI Pipeline]
    #|    A[Push Code] --> B{Tests Pass?}
    #|    B -->|Yes| C[Build Image]
    #|    B -->|No| D[Fix & Retry]
    #|    D -.-> A
    #|  end
    #|  C --> E([Deploy Staging])
    #|  E --> F{QA Approved?}
    #|  F -->|Yes| G((Production))
    #|  F -->|No| D
  )
}

///|
fn ci_cd_pipeline_expected_ascii() -> String {
  (
    #|+----------------------------------------+
    #||              CI Pipeline               |
    #||                                        |
    #||                                        |
    #|| +----------------+                     |
    #|| |                |                     |
    #|| |   Push Code    |<-----------+        |
    #|| |                |            |        |
    #|| +----------------+            |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          v                    |        |
    #|| +----------------+            |        |
    #|| |                |            |        |
    #|| |  Tests Pass?   |----No------+        |
    #|| |                |            |        |
    #|| +----------------+            |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          |                    |        |
    #||         Yes                   |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          |                    |        |
    #||          v                    v        |
    #|| +----------------+     +-------------+ |
    #|| |                |     |             | |
    #|| |  Build Image   |     | Fix & Retry | |
    #|| |                |     |             | |
    #|| +----------------+     +-------------+ |
    #||          |                    ^        |
    #|+----------|--------------------|--------+
    #|           |                    |
    #|           |                    |
    #|           v                    |
    #|  +----------------+            |
    #|  |                |            |
    #|  | Deploy Staging |            |
    #|  |                |            |
    #|  +----------------+            |
    #|           |                    |
    #|           |                    |
    #|           |                    |
    #|           |                    |
    #|           v                    |
    #|  +----------------+            |
    #|  |                |            |
    #|  |  QA Approved?  |----No------+
    #|  |                |
    #|  +----------------+
    #|           |
    #|           |
    #|           |
    #|          Yes
    #|           |
    #|           |
    #|           v
    #|  +----------------+
    #|  |                |
    #|  |   Production   |
    #|  |                |
    #|  +----------------+
  )
}

///|
fn ci_cd_pipeline_expected_unicode() -> String {
  (
    #|┌────────────────────────────────────────┐
    #|│              CI Pipeline               │
    #|│                                        │
    #|│                                        │
    #|│ ┌────────────────┐                     │
    #|│ │                │                     │
    #|│ │   Push Code    │◄───────────┐        │
    #|│ │                │            │        │
    #|│ └────────┬───────┘            │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          ▼                    │        │
    #|│ ┌────────────────┐            │        │
    #|│ │                │            │        │
    #|│ │  Tests Pass?   ├────No──────┤        │
    #|│ │                │            │        │
    #|│ └────────┬───────┘            │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│         Yes                   │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          │                    │        │
    #|│          ▼                    ▼        │
    #|│ ┌────────────────┐     ┌──────┴──────┐ │
    #|│ │                │     │             │ │
    #|│ │  Build Image   │     │ Fix & Retry │ │
    #|│ │                │     │             │ │
    #|│ └────────┬───────┘     └─────────────┘ │
    #|│          │                    ▲        │
    #|└──────────┼────────────────────┼────────┘
    #|           │                    │
    #|           │                    │
    #|           ▼                    │
    #|  ┌────────────────┐            │
    #|  │                │            │
    #|  │ Deploy Staging │            │
    #|  │                │            │
    #|  └────────┬───────┘            │
    #|           │                    │
    #|           │                    │
    #|           │                    │
    #|           │                    │
    #|           ▼                    │
    #|  ┌────────────────┐            │
    #|  │                │            │
    #|  │  QA Approved?  ├────No──────┘
    #|  │                │
    #|  └────────┬───────┘
    #|           │
    #|           │
    #|           │
    #|          Yes
    #|           │
    #|           │
    #|           ▼
    #|  ┌────────────────┐
    #|  │                │
    #|  │   Production   │
    #|  │                │
    #|  └────────────────┘
  )
}

///|
fn decision_tree_source() -> String {
  (
    #|graph TD
    #|  A{Is it raining?} -->|Yes| B{Have umbrella?}
    #|  A -->|No| C([Go outside])
    #|  B -->|Yes| D([Go with umbrella])
    #|  B -->|No| E{Is it heavy?}
    #|  E -->|Yes| F([Stay inside])
    #|  E -->|No| G([Run for it])
  )
}

///|
fn decision_tree_expected_ascii() -> String {
  (
    #|+------------------+
    #||                  |
    #||  Is it raining?  |-----No------+
    #||                  |             |
    #|+------------------+             |
    #|          |                      |
    #|          |                      |
    #|         Yes                     |
    #|          |                      |
    #|          v                      v
    #|+------------------+     +--------------+
    #||                  |     |              |
    #||  Have umbrella?  |-----|  Go outside  |
    #||                  |     |              |
    #|+------------------+     +--------------+
    #|          |              No      |
    #|          |                      |
    #|         Yes                     |
    #|          |                      |
    #|          v                      v
    #|+------------------+     +--------------+
    #||                  |     |              |
    #|| Go with umbrella |-----| Is it heavy? |
    #||                  |     |              |
    #|+------------------+     +--------------+
    #|          |     Yes              |
    #|          |                      |
    #|          |                     No
    #|          |                      |
    #|          v                      v
    #|+------------------+     +--------------+
    #||                  |     |              |
    #||   Stay inside    |     |  Run for it  |
    #||                  |     |              |
    #|+------------------+     +--------------+
  )
}

///|
fn decision_tree_expected_unicode() -> String {
  (
    #|┌──────────────────┐
    #|│                  │
    #|│  Is it raining?  ├─────No──────┐
    #|│                  │             │
    #|└─────────┬────────┘             │
    #|          │                      │
    #|          │                      │
    #|         Yes                     │
    #|          │                      │
    #|          ▼                      ▼
    #|┌──────────────────┐     ┌──────────────┐
    #|│                  │     │              │
    #|│  Have umbrella?  ├─────│  Go outside  │
    #|│                  │     │              │
    #|└─────────┬────────┘     └──────────────┘
    #|          │              No      │
    #|          │                      │
    #|         Yes                     │
    #|          │                      │
    #|          ▼                      ▼
    #|┌──────────────────┐     ┌──────────────┐
    #|│                  │     │              │
    #|│ Go with umbrella │─────┤ Is it heavy? │
    #|│                  │     │              │
    #|└──────────────────┘     └───────┬──────┘
    #|          │     Yes              │
    #|          │                      │
    #|          │                     No
    #|          │                      │
    #|          ▼                      ▼
    #|┌──────────────────┐     ┌──────────────┐
    #|│                  │     │              │
    #|│   Stay inside    │     │  Run for it  │
    #|│                  │     │              │
    #|└──────────────────┘     └──────────────┘
  )
}

///|
fn system_architecture_source() -> String {
  (
    #|graph LR
    #|  subgraph clients [Client Layer]
    #|    A([Web App]) --> B[API Gateway]
    #|    C([Mobile App]) --> B
    #|  end
    #|  subgraph services [Service Layer]
    #|    B --> D[Auth Service]
    #|    B --> E[User Service]
    #|    B --> F[Order Service]
    #|  end
    #|  subgraph data [Data Layer]
    #|    D --> G[(Auth DB)]
    #|    E --> H[(User DB)]
    #|    F --> I[(Order DB)]
    #|    F --> J([Message Queue])
    #|  end
  )
}

///|
fn system_architecture_expected_ascii() -> String {
  (
    #|+------------------------------------+ +-------------------+ +-------------------+
    #||           Client Layer             | |   Service Layer   | |    Data Layer     |
    #||                                    | |                   | |                   |
    #||                                    | |                   | |                   |
    #|| +------------+     +-------------+ | | +---------------+ | | +---------------+ |
    #|| |            |     |             | | | |               | | | |               | |
    #|| |  Web App   |---->| API Gateway |---->|  Auth Service |---->|    Auth DB    | |
    #|| |            |     |             | | | |               | | | |               | |
    #|| +------------+     +-------------+ | | +---------------+ | | +---------------+ |
    #||                           ^        | |                   | |                   |
    #||                           |        | |                   | |                   |
    #||                           |        | |                   | |                   |
    #||                           |        | |                   | |                   |
    #||                           |        | |                   | |                   |
    #|| +------------+            |        | | +---------------+ | | +---------------+ |
    #|| |            |            |        | | |               | | | |               | |
    #|| | Mobile App |------------+----------->|  User Service |---->|    User DB    | |
    #|| |            |            |        | | |               | | | |               | |
    #|| +------------+            |        | | +---------------+ | | +---------------+ |
    #||                           |        | |                   | |                   |
    #|+---------------------------|--------+ |                   | |                   |
    #|                            |          |                   | |                   |
    #|                            |          |                   | |                   |
    #|                            |          |                   | |                   |
    #|                            |          | +---------------+ | | +---------------+ |
    #|                            |          | |               | | | |               | |
    #|                            +----------->| Order Service |---->|    Order DB   | |
    #|                                       | |               | | | |               | |
    #|                                       | +---------------+ | | +---------------+ |
    #|                                       |         |         | |                   |
    #|                                       +---------|---------+ |                   |
    #|                                                 |           |                   |
    #|                                                 |           |                   |
    #|                                                 |           |                   |
    #|                                                 |           | +---------------+ |
    #|                                                 |           | |               | |
    #|                                                 +------------>| Message Queue | |
    #|                                                             | |               | |
    #|                                                             | +---------------+ |
    #|                                                             |                   |
    #|                                                             +-------------------+
  )
}

///|
fn system_architecture_expected_unicode() -> String {
  (
    #|┌────────────────────────────────────┐ ┌───────────────────┐ ┌───────────────────┐
    #|│           Client Layer             │ │   Service Layer   │ │    Data Layer     │
    #|│                                    │ │                   │ │                   │
    #|│                                    │ │                   │ │                   │
    #|│ ┌────────────┐     ┌─────────────┐ │ │ ┌───────────────┐ │ │ ┌───────────────┐ │
    #|│ │            │     │             │ │ │ │               │ │ │ │               │ │
    #|│ │  Web App   ├────►│ API Gateway ├─┼─┼►│  Auth Service ├─┼─┼►│    Auth DB    │ │
    #|│ │            │     │             │ │ │ │               │ │ │ │               │ │
    #|│ └────────────┘     └──────┬──────┘ │ │ └───────────────┘ │ │ └───────────────┘ │
    #|│                           ▲        │ │                   │ │                   │
    #|│                           │        │ │                   │ │                   │
    #|│                           │        │ │                   │ │                   │
    #|│                           │        │ │                   │ │                   │
    #|│                           │        │ │                   │ │                   │
    #|│ ┌────────────┐            │        │ │ ┌───────────────┐ │ │ ┌───────────────┐ │
    #|│ │            │            │        │ │ │               │ │ │ │               │ │
    #|│ │ Mobile App ├────────────┼────────┼─┼►│  User Service ├─┼─┼►│    User DB    │ │
    #|│ │            │            │        │ │ │               │ │ │ │               │ │
    #|│ └────────────┘            │        │ │ └───────────────┘ │ │ └───────────────┘ │
    #|│                           │        │ │                   │ │                   │
    #|└───────────────────────────┼────────┘ │                   │ │                   │
    #|                            │          │                   │ │                   │
    #|                            │          │                   │ │                   │
    #|                            │          │                   │ │                   │
    #|                            │          │ ┌───────────────┐ │ │ ┌───────────────┐ │
    #|                            │          │ │               │ │ │ │               │ │
    #|                            └──────────┼►│ Order Service ├─┼─┼►│    Order DB   │ │
    #|                                       │ │               │ │ │ │               │ │
    #|                                       │ └───────┬───────┘ │ │ └───────────────┘ │
    #|                                       │         │         │ │                   │
    #|                                       └─────────┼─────────┘ │                   │
    #|                                                 │           │                   │
    #|                                                 │           │                   │
    #|                                                 │           │                   │
    #|                                                 │           │ ┌───────────────┐ │
    #|                                                 │           │ │               │ │
    #|                                                 └───────────┼►│ Message Queue │ │
    #|                                                             │ │               │ │
    #|                                                             │ └───────────────┘ │
    #|                                                             │                   │
    #|                                                             └───────────────────┘
  )
}

///|
fn subgraphs_source() -> String {
  (
    #|graph TD
    #|  subgraph Frontend
    #|    A[React App] --> B[State Manager]
    #|  end
    #|  subgraph Backend
    #|    C[API Server] --> D[Database]
    #|  end
    #|  B --> C
  )
}

///|
fn subgraphs_expected_ascii() -> String {
  (
    #|+-------------------+
    #||     Frontend      |
    #||                   |
    #||                   |
    #|| +---------------+ |
    #|| |               | |
    #|| |   React App   | |
    #|| |               | |
    #|| +---------------+ |
    #||         |         |
    #||         |         |
    #||         |         |
    #||         |         |
    #||         v         |
    #|| +---------------+ |
    #|| |               | |
    #|| | State Manager | |
    #|| |               | |
    #|| +---------------+ |
    #||         |         |
    #|+---------|---------+
    #|          |
    #|          |
    #|          |
    #|+---------|---------+
    #||      Backend      |
    #||         |         |
    #||         v         |
    #|| +---------------+ |
    #|| |               | |
    #|| |   API Server  | |
    #|| |               | |
    #|| +---------------+ |
    #||         |         |
    #||         |         |
    #||         |         |
    #||         |         |
    #||         v         |
    #|| +---------------+ |
    #|| |               | |
    #|| |    Database   | |
    #|| |               | |
    #|| +---------------+ |
    #||                   |
    #|+-------------------+
  )
}

///|
fn subgraphs_expected_unicode() -> String {
  (
    #|┌───────────────────┐
    #|│     Frontend      │
    #|│                   │
    #|│                   │
    #|│ ┌───────────────┐ │
    #|│ │               │ │
    #|│ │   React App   │ │
    #|│ │               │ │
    #|│ └───────┬───────┘ │
    #|│         │         │
    #|│         │         │
    #|│         │         │
    #|│         │         │
    #|│         ▼         │
    #|│ ┌───────────────┐ │
    #|│ │               │ │
    #|│ │ State Manager │ │
    #|│ │               │ │
    #|│ └───────┬───────┘ │
    #|│         │         │
    #|└─────────┼─────────┘
    #|          │
    #|          │
    #|          │
    #|┌─────────┼─────────┐
    #|│      Backend      │
    #|│         │         │
    #|│         ▼         │
    #|│ ┌───────────────┐ │
    #|│ │               │ │
    #|│ │   API Server  │ │
    #|│ │               │ │
    #|│ └───────┬───────┘ │
    #|│         │         │
    #|│         │         │
    #|│         │         │
    #|│         │         │
    #|│         ▼         │
    #|│ ┌───────────────┐ │
    #|│ │               │ │
    #|│ │    Database   │ │
    #|│ │               │ │
    #|│ └───────────────┘ │
    #|│                   │
    #|└───────────────────┘
  )
}

///|
fn nested_subgraphs_source() -> String {
  (
    #|graph TD
    #|  subgraph Cloud
    #|    subgraph us-east [US East Region]
    #|      A[Web Server] --> B[App Server]
    #|    end
    #|    subgraph us-west [US West Region]
    #|      C[Web Server] --> D[App Server]
    #|    end
    #|  end
    #|  E[Load Balancer] --> A
    #|  E --> C
  )
}

///|
fn nested_subgraphs_expected_ascii() -> String {
  (
    #|+---------------------------------------+
    #||                 Cloud                 |
    #||                                       |
    #||                                       |
    #|| +----------------+ +----------------+ |
    #|| |US East Region  | |US West Region  | |
    #|| |                | |                | |
    #|| |                | |                | |
    #|| | +------------+ | | +------------+ | | +---------------+
    #|| | |            | | | |            | | | |               |
    #|| | | Web Server |<-+| | Web Server |<-+--| Load Balancer |
    #|| | |            | ||| |            | ||| |               |
    #|| | +------------+ ||| +------------+ ||| +---------------+
    #|| |        |       |||        |       |||
    #|| |        |       |||        |       |||
    #|| |        |       |+------------------+|
    #|| |        |       | |        |       | |
    #|| |        v       | |        v       | |
    #|| | +------------+ | | +------------+ | |
    #|| | |            | | | |            | | |
    #|| | | App Server | | | | App Server | | |
    #|| | |            | | | |            | | |
    #|| | +------------+ | | +------------+ | |
    #|| |                | |                | |
    #|| +----------------+ +----------------+ |
    #||                                       |
    #|+---------------------------------------+
  )
}

///|
fn nested_subgraphs_expected_unicode() -> String {
  (
    #|┌───────────────────────────────────────┐
    #|│                 Cloud                 │
    #|│                                       │
    #|│                                       │
    #|│ ┌────────────────┐ ┌────────────────┐ │
    #|│ │US East Region  │ │US West Region  │ │
    #|│ │                │ │                │ │
    #|│ │                │ │                │ │
    #|│ │ ┌────────────┐ │ │ ┌────────────┐ │ │ ┌───────────────┐
    #|│ │ │            │ │ │ │            │ │ │ │               │
    #|│ │ │ Web Server │◄┼┐│ │ Web Server │◄┼┬┼─┤ Load Balancer │
    #|│ │ │            │ │││ │            │ │││ │               │
    #|│ │ └──────┬─────┘ │││ └──────┬─────┘ │││ └───────────────┘
    #|│ │        │       │││        │       │││
    #|│ │        │       │││        │       │││
    #|│ │        │       │└┼────────┼───────┼┘│
    #|│ │        │       │ │        │       │ │
    #|│ │        ▼       │ │        ▼       │ │
    #|│ │ ┌────────────┐ │ │ ┌────────────┐ │ │
    #|│ │ │            │ │ │ │            │ │ │
    #|│ │ │ App Server │ │ │ │ App Server │ │ │
    #|│ │ │            │ │ │ │            │ │ │
    #|│ │ └────────────┘ │ │ └────────────┘ │ │
    #|│ │                │ │                │ │
    #|│ └────────────────┘ └────────────────┘ │
    #|│                                       │
    #|└───────────────────────────────────────┘
  )
}

///|
fn simple_flow_source() -> String {
  (
    #|graph TD
    #|  A[Start] --> B[Process] --> C[End]
  )
}

///|
fn simple_flow_expected_ascii() -> String {
  (
    #|+---------+
    #||         |
    #||  Start  |
    #||         |
    #|+---------+
    #|     |
    #|     |
    #|     |
    #|     |
    #|     v
    #|+---------+
    #||         |
    #|| Process |
    #||         |
    #|+---------+
    #|     |
    #|     |
    #|     |
    #|     |
    #|     v
    #|+---------+
    #||         |
    #||   End   |
    #||         |
    #|+---------+
  )
}

///|
fn simple_flow_expected_unicode() -> String {
  (
    #|┌─────────┐
    #|│         │
    #|│  Start  │
    #|│         │
    #|└────┬────┘
    #|     │
    #|     │
    #|     │
    #|     │
    #|     ▼
    #|┌─────────┐
    #|│         │
    #|│ Process │
    #|│         │
    #|└────┬────┘
    #|     │
    #|     │
    #|     │
    #|     │
    #|     ▼
    #|┌─────────┐
    #|│         │
    #|│   End   │
    #|│         │
    #|└─────────┘
  )
}

///|
fn original_node_shapes_source() -> String {
  (
    #|graph LR
    #|  A[Rectangle] --> B(Rounded)
    #|  B --> C{Diamond}
    #|  C --> D([Stadium])
    #|  D --> E((Circle))
  )
}

///|
fn original_node_shapes_expected_ascii() -> String {
  (
    #|+-----------+     +---------+     +---------+     +---------+     +--------+
    #||           |     |         |     |         |     |         |     |        |
    #|| Rectangle |---->| Rounded |---->| Diamond |---->| Stadium |---->| Circle |
    #||           |     |         |     |         |     |         |     |        |
    #|+-----------+     +---------+     +---------+     +---------+     +--------+
  )
}

///|
fn original_node_shapes_expected_unicode() -> String {
  (
    #|┌───────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌────────┐
    #|│           │     │         │     │         │     │         │     │        │
    #|│ Rectangle ├────►│ Rounded ├────►│ Diamond ├────►│ Stadium ├────►│ Circle │
    #|│           │     │         │     │         │     │         │     │        │
    #|└───────────┘     └─────────┘     └─────────┘     └─────────┘     └────────┘
  )
}

///|
fn batch_1_shapes_source() -> String {
  (
    #|graph LR
    #|  A[[Subroutine]] --> B(((Double Circle)))
    #|  B --> C{{Hexagon}}
  )
}

///|
fn batch_1_shapes_expected_ascii() -> String {
  (
    #|+------------+     +---------------+     +---------+
    #||            |     |               |     |         |
    #|| Subroutine |---->| Double Circle |---->| Hexagon |
    #||            |     |               |     |         |
    #|+------------+     +---------------+     +---------+
  )
}

///|
fn batch_1_shapes_expected_unicode() -> String {
  (
    #|┌────────────┐     ┌───────────────┐     ┌─────────┐
    #|│            │     │               │     │         │
    #|│ Subroutine ├────►│ Double Circle ├────►│ Hexagon │
    #|│            │     │               │     │         │
    #|└────────────┘     └───────────────┘     └─────────┘
  )
}

///|
fn batch_2_shapes_source() -> String {
  (
    #|graph LR
    #|  A[(Database)] --> B>Flag Shape]
    #|  B --> C[/Wider Bottom\]
    #|  C --> D[\Wider Top/]
  )
}

///|
fn batch_2_shapes_expected_ascii() -> String {
  (
    #|+----------+     +------------+     +--------------+     +-----------+
    #||          |     |            |     |              |     |           |
    #|| Database |---->| Flag Shape |---->| Wider Bottom |---->| Wider Top |
    #||          |     |            |     |              |     |           |
    #|+----------+     +------------+     +--------------+     +-----------+
  )
}

///|
fn batch_2_shapes_expected_unicode() -> String {
  (
    #|┌──────────┐     ┌────────────┐     ┌──────────────┐     ┌───────────┐
    #|│          │     │            │     │              │     │           │
    #|│ Database ├────►│ Flag Shape ├────►│ Wider Bottom ├────►│ Wider Top │
    #|│          │     │            │     │              │     │           │
    #|└──────────┘     └────────────┘     └──────────────┘     └───────────┘
  )
}

///|
fn all_edge_styles_source() -> String {
  (
    #|graph TD
    #|  A[Source] -->|solid| B[Target 1]
    #|  A -.->|dotted| C[Target 2]
    #|  A ==>|thick| D[Target 3]
  )
}

///|
fn all_edge_styles_expected_ascii() -> String {
  (
    #|+----------+
    #||          |
    #||  Source  |--dotted---thick------------+
    #||          |           |                |
    #|+----------+           |                |
    #|      |                |                |
    #|      |                |                |
    #|    solid              |                |
    #|      |                |                |
    #|      v                v                v
    #|+----------+     +----------+     +----------+
    #||          |     |          |     |          |
    #|| Target 1 |     | Target 2 |     | Target 3 |
    #||          |     |          |     |          |
    #|+----------+     +----------+     +----------+
  )
}

///|
fn all_edge_styles_expected_unicode() -> String {
  (
    #|┌──────────┐
    #|│          │
    #|│  Source  ├──dotted───thick────────────┐
    #|│          │           │                │
    #|└─────┬────┘           │                │
    #|      │                │                │
    #|      │                │                │
    #|    solid              │                │
    #|      │                │                │
    #|      ▼                ▼                ▼
    #|┌──────────┐     ┌──────────┐     ┌──────────┐
    #|│          │     │          │     │          │
    #|│ Target 1 │     │ Target 2 │     │ Target 3 │
    #|│          │     │          │     │          │
    #|└──────────┘     └──────────┘     └──────────┘
  )
}

///|
fn no_arrow_edges_source() -> String {
  (
    #|graph TD
    #|  A[Node 1] ---|related| B[Node 2]
    #|  B -.- C[Node 3]
    #|  C === D[Node 4]
  )
}

///|
fn no_arrow_edges_expected_ascii() -> String {
  (
    #|+---------+
    #||         |
    #||  Node 1 |
    #||         |
    #|+---------+
    #|     |
    #|     |
    #|  related
    #|     |
    #|     v
    #|+---------+
    #||         |
    #||  Node 2 |
    #||         |
    #|+---------+
    #|     |
    #|     |
    #|     |
    #|     |
    #|     v
    #|+---------+
    #||         |
    #||  Node 3 |
    #||         |
    #|+---------+
    #|     |
    #|     |
    #|     |
    #|     |
    #|     v
    #|+---------+
    #||         |
    #||  Node 4 |
    #||         |
    #|+---------+
  )
}

///|
fn no_arrow_edges_expected_unicode() -> String {
  (
    #|┌─────────┐
    #|│         │
    #|│  Node 1 │
    #|│         │
    #|└────┬────┘
    #|     │
    #|     │
    #|  related
    #|     │
    #|     ▼
    #|┌─────────┐
    #|│         │
    #|│  Node 2 │
    #|│         │
    #|└────┬────┘
    #|     │
    #|     │
    #|     │
    #|     │
    #|     ▼
    #|┌─────────┐
    #|│         │
    #|│  Node 3 │
    #|│         │
    #|└────┬────┘
    #|     │
    #|     │
    #|     │
    #|     │
    #|     ▼
    #|┌─────────┐
    #|│         │
    #|│  Node 4 │
    #|│         │
    #|└─────────┘
  )
}

///|
fn bidirectional_arrows_source() -> String {
  (
    #|graph LR
    #|  A[Client] <-->|sync| B[Server]
    #|  B <-.->|heartbeat| C[Monitor]
    #|  C <==>|data| D[Storage]
  )
}

///|
fn bidirectional_arrows_expected_ascii() -> String {
  (
    #|+--------+      +--------+           +---------+      +---------+
    #||        |      |        |           |         |      |         |
    #|| Client |sync->| Server |-heartbeat>| Monitor |data->| Storage |
    #||        |      |        |           |         |      |         |
    #|+--------+      +--------+           +---------+      +---------+
  )
}

///|
fn bidirectional_arrows_expected_unicode() -> String {
  (
    #|┌────────┐      ┌────────┐           ┌─────────┐      ┌─────────┐
    #|│        │      │        │           │         │      │         │
    #|│ Client ├sync─►│ Server ├─heartbeat►│ Monitor ├data─►│ Storage │
    #|│        │      │        │           │         │      │         │
    #|└────────┘      └────────┘           └─────────┘      └─────────┘
  )
}

///|
fn parallel_links_and_source() -> String {
  (
    #|graph TD
    #|  A[Input] & B[Config] --> C[Processor]
    #|  C --> D[Output] & E[Log]
  )
}

///|
fn parallel_links_and_expected_ascii() -> String {
  (
    #|+-----------+     +--------+
    #||           |     |        |
    #||   Input   |     | Config |
    #||           |     |        |
    #|+-----------+     +--------+
    #|      |                |
    #|      |                |
    #|      |                |
    #|      |                |
    #|      v                |
    #|+-----------+          |
    #||           |          |
    #|| Processor |<---------+
    #||           |          |
    #|+-----------+          |
    #|      |                |
    #|      |                |
    #|      |                |
    #|      |                |
    #|      v                v
    #|+-----------+     +--------+
    #||           |     |        |
    #||   Output  |     |  Log   |
    #||           |     |        |
    #|+-----------+     +--------+
  )
}

///|
fn parallel_links_and_expected_unicode() -> String {
  (
    #|┌───────────┐     ┌────────┐
    #|│           │     │        │
    #|│   Input   │     │ Config │
    #|│           │     │        │
    #|└─────┬─────┘     └────┬───┘
    #|      │                │
    #|      │                │
    #|      │                │
    #|      │                │
    #|      ▼                │
    #|┌───────────┐          │
    #|│           │          │
    #|│ Processor ├◄─────────┤
    #|│           │          │
    #|└─────┬─────┘          │
    #|      │                │
    #|      │                │
    #|      │                │
    #|      │                │
    #|      ▼                ▼
    #|┌───────────┐     ┌────────┐
    #|│           │     │        │
    #|│   Output  │     │  Log   │
    #|│           │     │        │
    #|└───────────┘     └────────┘
  )
}

///|
fn chained_edges_source() -> String {
  (
    #|graph LR
    #|  A[Step 1] --> B[Step 2] --> C[Step 3] --> D[Step 4] --> E[Step 5]
  )
}

///|
fn chained_edges_expected_ascii() -> String {
  (
    #|+--------+     +--------+     +--------+     +--------+     +--------+
    #||        |     |        |     |        |     |        |     |        |
    #|| Step 1 |---->| Step 2 |---->| Step 3 |---->| Step 4 |---->| Step 5 |
    #||        |     |        |     |        |     |        |     |        |
    #|+--------+     +--------+     +--------+     +--------+     +--------+
  )
}

///|
fn chained_edges_expected_unicode() -> String {
  (
    #|┌────────┐     ┌────────┐     ┌────────┐     ┌────────┐     ┌────────┐
    #|│        │     │        │     │        │     │        │     │        │
    #|│ Step 1 ├────►│ Step 2 ├────►│ Step 3 ├────►│ Step 4 ├────►│ Step 5 │
    #|│        │     │        │     │        │     │        │     │        │
    #|└────────┘     └────────┘     └────────┘     └────────┘     └────────┘
  )
}

///|
fn direction_left_right_lr_source() -> String {
  (
    #|graph LR
    #|  A[Input] --> B[Transform] --> C[Output]
  )
}

///|
fn direction_left_right_lr_expected_ascii() -> String {
  (
    #|+-------+     +-----------+     +--------+
    #||       |     |           |     |        |
    #|| Input |---->| Transform |---->| Output |
    #||       |     |           |     |        |
    #|+-------+     +-----------+     +--------+
  )
}

///|
fn direction_left_right_lr_expected_unicode() -> String {
  (
    #|┌───────┐     ┌───────────┐     ┌────────┐
    #|│       │     │           │     │        │
    #|│ Input ├────►│ Transform ├────►│ Output │
    #|│       │     │           │     │        │
    #|└───────┘     └───────────┘     └────────┘
  )
}

///|
fn direction_bottom_top_bt_source() -> String {
  (
    #|graph BT
    #|  A[Foundation] --> B[Layer 2] --> C[Top]
  )
}

///|
fn direction_bottom_top_bt_expected_ascii() -> String {
  (
    #|+------------+
    #||            |
    #||    Top     |
    #||            |
    #|+------------+
    #|       ^
    #|       |
    #|       |
    #|       |
    #|       |
    #|+------------+
    #||            |
    #||  Layer 2   |
    #||            |
    #|+------------+
    #|       ^
    #|       |
    #|       |
    #|       |
    #|       |
    #|+------------+
    #||            |
    #|| Foundation |
    #||            |
    #|+------------+
  )
}

///|
fn direction_bottom_top_bt_expected_unicode() -> String {
  (
    #|┌────────────┐
    #|│            │
    #|│    Top     │
    #|│            │
    #|└────────────┘
    #|       ▲
    #|       │
    #|       │
    #|       │
    #|       │
    #|┌──────┴─────┐
    #|│            │
    #|│  Layer 2   │
    #|│            │
    #|└────────────┘
    #|       ▲
    #|       │
    #|       │
    #|       │
    #|       │
    #|┌──────┴─────┐
    #|│            │
    #|│ Foundation │
    #|│            │
    #|└────────────┘
  )
}

///|
fn all_12_flowchart_shapes_source() -> String {
  (
    #|graph LR
    #|  A[Rectangle] --> B(Rounded)
    #|  B --> C{Diamond}
    #|  C --> D([Stadium])
    #|  D --> E((Circle))
    #|  E --> F[[Subroutine]]
    #|  F --> G(((Double Circle)))
    #|  G --> H{{Hexagon}}
    #|  H --> I[(Database)]
    #|  I --> J>Flag]
    #|  J --> K[/Trapezoid\]
    #|  K --> L[\Inverse Trap/]
  )
}

///|
fn all_12_flowchart_shapes_expected_ascii() -> String {
  (
    #|+-----------+     +---------+     +---------+     +---------+     +--------+     +------------+     +---------------+     +---------+     +----------+     +------+     +-----------+     +--------------+
    #||           |     |         |     |         |     |         |     |        |     |            |     |               |     |         |     |          |     |      |     |           |     |              |
    #|| Rectangle |---->| Rounded |---->| Diamond |---->| Stadium |---->| Circle |---->| Subroutine |---->| Double Circle |---->| Hexagon |---->| Database |---->| Flag |---->| Trapezoid |---->| Inverse Trap |
    #||           |     |         |     |         |     |         |     |        |     |            |     |               |     |         |     |          |     |      |     |           |     |              |
    #|+-----------+     +---------+     +---------+     +---------+     +--------+     +------------+     +---------------+     +---------+     +----------+     +------+     +-----------+     +--------------+
  )
}

///|
fn all_12_flowchart_shapes_expected_unicode() -> String {
  (
    #|┌───────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌────────┐     ┌────────────┐     ┌───────────────┐     ┌─────────┐     ┌──────────┐     ┌──────┐     ┌───────────┐     ┌──────────────┐
    #|│           │     │         │     │         │     │         │     │        │     │            │     │               │     │         │     │          │     │      │     │           │     │              │
    #|│ Rectangle ├────►│ Rounded ├────►│ Diamond ├────►│ Stadium ├────►│ Circle ├────►│ Subroutine ├────►│ Double Circle ├────►│ Hexagon ├────►│ Database ├────►│ Flag ├────►│ Trapezoid ├────►│ Inverse Trap │
    #|│           │     │         │     │         │     │         │     │        │     │            │     │               │     │         │     │          │     │      │     │           │     │              │
    #|└───────────┘     └─────────┘     └─────────┘     └─────────┘     └────────┘     └────────────┘     └───────────────┘     └─────────┘     └──────────┘     └──────┘     └───────────┘     └──────────────┘
  )
}

///|
fn class_shorthand_source() -> String {
  (
    #|graph TD
    #|  A[Normal]:::default --> B[Highlighted]:::highlight --> C[Error]:::error
    #|  classDef default fill:#f4f4f5,stroke:#a1a1aa
    #|  classDef highlight fill:#fbbf24,stroke:#d97706
    #|  classDef error fill:#ef4444,stroke:#dc2626
  )
}

///|
fn class_shorthand_expected_ascii() -> String {
  (
    #|+-------------+
    #||             |
    #||    Normal   |
    #||             |
    #|+-------------+
    #|       |
    #|       |
    #|       |
    #|       |
    #|       v
    #|+-------------+
    #||             |
    #|| Highlighted |
    #||             |
    #|+-------------+
    #|       |
    #|       |
    #|       |
    #|       |
    #|       v
    #|+-------------+
    #||             |
    #||    Error    |
    #||             |
    #|+-------------+
  )
}

///|
fn class_shorthand_expected_unicode() -> String {
  (
    #|┌─────────────┐
    #|│             │
    #|│    Normal   │
    #|│             │
    #|└──────┬──────┘
    #|       │
    #|       │
    #|       │
    #|       │
    #|       ▼
    #|┌─────────────┐
    #|│             │
    #|│ Highlighted │
    #|│             │
    #|└──────┬──────┘
    #|       │
    #|       │
    #|       │
    #|       │
    #|       ▼
    #|┌─────────────┐
    #|│             │
    #|│    Error    │
    #|│             │
    #|└─────────────┘
  )
}

///|
fn inline_style_overrides_source() -> String {
  (
    #|graph TD
    #|  A[Default] --> B[Custom Colors] --> C[Another Custom]
    #|  style B fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    #|  style C fill:#10b981,stroke:#059669
  )
}

///|
fn inline_style_overrides_expected_ascii() -> String {
  [
    "+----------------+", "|                |", "|    Default     |", "|                |",
    "+----------------+", "         |        ", "         |        ", "         |        ",
    "         |        ", "         v        ", "+----------------+", "|                |",
    "| Custom Colors  |", "|                |", "+----------------+", "         |        ",
    "         |        ", "         |        ", "         |        ", "         v        ",
    "+----------------+", "|                |", "| Another Custom |", "|                |",
    "+----------------+",
  ]
  .iter()
  .join("\n")
}

///|
fn inline_style_overrides_expected_unicode() -> String {
  [
    "┌────────────────┐", "│                │",
    "│    Default     │", "│                │", "└────────┬───────┘",
    "         │        ", "         │        ", "         │        ", "         │        ",
    "         ▼        ", "┌────────────────┐",
    "│                │", "│ Custom Colors  │", "│                │",
    "└────────┬───────┘", "         │        ",
    "         │        ", "         │        ", "         │        ", "         ▼        ",
    "┌────────────────┐", "│                │",
    "│ Another Custom │", "│                │", "└────────────────┘",
  ]
  .iter()
  .join("\n")
}

///|
fn basic_state_diagram_source() -> String {
  (
    #|stateDiagram-v2
    #|  [*] --> Idle
    #|  Idle --> Active : start
    #|  Active --> Idle : cancel
    #|  Active --> Done : complete
    #|  Done --> [*]
  )
}

///|
fn basic_state_diagram_expected_ascii() -> String {
  [
    "+----------+", "|          |", "|          |", "|          |", "+----------+",
    "      |     ", "      |     ", "      |     ", "      |     ", "      v     ",
    "+----------+", "|          |", "|   Idle   |", "|          |", "+----------+",
    "      ^     ", "      |     ", "   cancel   ", "      |     ", "      v     ",
    "+----------+", "|          |", "|  Active  |", "|          |", "+----------+",
    "      |     ", "      |     ", "  complete  ", "      |     ", "      v     ",
    "+----------+", "|          |", "|   Done   |", "|          |", "+----------+",
    "      |     ", "      |     ", "      |     ", "      |     ", "      v     ",
    "+----------+", "|          |", "|          |", "|          |", "+----------+",
  ]
  .iter()
  .join("\n")
}

///|
fn basic_state_diagram_expected_unicode() -> String {
  [
    "┌──────────┐", "│          │", "│          │",
    "│          │", "└─────┬────┘", "      │     ",
    "      │     ", "      │     ", "      │     ", "      ▼     ", "┌──────────┐",
    "│          │", "│   Idle   │", "│          │", "└─────┬────┘",
    "      ▲     ", "      │     ", "   cancel   ", "      │     ", "      ▼     ",
    "┌─────┴────┐", "│          │", "│  Active  │",
    "│          │", "└─────┬────┘", "      │     ",
    "      │     ", "  complete  ", "      │     ", "      ▼     ", "┌──────────┐",
    "│          │", "│   Done   │", "│          │", "└─────┬────┘",
    "      │     ", "      │     ", "      │     ", "      │     ", "      ▼     ",
    "┌──────────┐", "│          │", "│          │",
    "│          │", "└──────────┘",
  ]
  .iter()
  .join("\n")
}

///|
fn state_composite_states_source() -> String {
  (
    #|stateDiagram-v2
    #|  [*] --> Idle
    #|  Idle --> Processing : submit
    #|  state Processing {
    #|    parse --> validate
    #|    validate --> execute
    #|  }
    #|  Processing --> Complete : done
    #|  Processing --> Error : fail
    #|  Error --> Idle : retry
    #|  Complete --> [*]
  )
}

///|
fn state_composite_states_expected_ascii() -> String {
  [
    "                      +--------------+", "                      | Processing   |",
    "                      |              |", "                      |              |",
    "+------------+        | +----------+ |", "|            |        | |          | |",
    "|            |        | |  parse   | |", "|            |        | |          | |",
    "+------------+        | +----------+ |", "       |              |       |      |",
    "       |              |       |      |", "       |              |       |      |",
    "       |              |       |      |", "       v              |       v      |",
    "+------------+        | +----------+ |", "|            |        | |          | |",
    "|    Idle    |   <---+| | validate | |", "|            |       || |          | |",
    "+------------+       || +----------+ |", "       |             ||       |      |",
    "       |             ||       |      |", "    submit           ||       |      |",
    "       |             ||       |      |", "       v             ||       v      |",
    "+------------+       || +----------+ |", "|            |       || |          | |",
    "| Processing |  fail-+| | execute  | |", "|            |       || |          | |",
    "+------------+       || +----------+ |", "       |             ||              |",
    "       |             |+--------------+", "     done            +--------+       ",
    "       |                    retry     ", "       v                      v       ",
    "+------------+          +----------+  ", "|            |          |          |  ",
    "|  Complete  |          |  Error   |  ", "|            |          |          |  ",
    "+------------+          +----------+  ", "       |                              ",
    "       |                              ", "       |                              ",
    "       |                              ", "       v                              ",
    "+------------+                        ", "|            |                        ",
    "|            |                        ", "|            |                        ",
    "+------------+                        ",
  ]
  .iter()
  .join("\n")
}

///|
fn state_composite_states_expected_unicode() -> String {
  [
    "                      ┌──────────────┐", "                      │ Processing   │",
    "                      │              │", "                      │              │",
    "┌────────────┐        │ ┌──────────┐ │",
    "│            │        │ │          │ │", "│            │        │ │  parse   │ │",
    "│            │        │ │          │ │", "└──────┬─────┘        │ └─────┬────┘ │",
    "       │              │       │      │", "       │              │       │      │",
    "       │              │       │      │", "       │              │       │      │",
    "       ▼              │       ▼      │", "┌────────────┐        │ ┌──────────┐ │",
    "│            │        │ │          │ │", "│    Idle    │   ◄───┐│ │ validate │ │",
    "│            │       ││ │          │ │", "└──────┬─────┘       ││ └─────┬────┘ │",
    "       │             ││       │      │", "       │             ││       │      │",
    "    submit           ││       │      │", "       │             ││       │      │",
    "       ▼             ││       ▼      │", "┌────────────┐       ││ ┌──────────┐ │",
    "│            │       ││ │          │ │", "│ Processing │  fail─┤│ │ execute  │ │",
    "│            │       ││ │          │ │", "└──────┬─────┘       ││ └──────────┘ │",
    "       │             ││              │", "       │             │└──────────────┘",
    "     done            └────────┐       ", "       │                    retry     ",
    "       ▼                      ▼       ", "┌────────────┐          ┌─────┴────┐  ",
    "│            │          │          │  ", "│  Complete  │          │  Error   │  ",
    "│            │          │          │  ", "└──────┬─────┘          └──────────┘  ",
    "       │                              ", "       │                              ",
    "       │                              ", "       │                              ",
    "       ▼                              ", "┌────────────┐                        ",
    "│            │                        ", "│            │                        ",
    "│            │                        ", "└────────────┘                        ",
  ]
  .iter()
  .join("\n")
}

///|
fn state_connection_lifecycle_sample_source() -> String {
  (
    #|stateDiagram-v2
    #|  [*] --> Closed
    #|  Closed --> Connecting : connect
    #|  Connecting --> Connected : success
    #|  Connecting --> Closed : timeout
    #|  Connected --> Disconnecting : close
    #|  Connected --> Reconnecting : error
    #|  Reconnecting --> Connected : success
    #|  Reconnecting --> Closed : max_retries
    #|  Disconnecting --> Closed : done
    #|  Closed --> [*]
  )
}

///|
fn state_connection_lifecycle_sample_expected_ascii() -> String {
  [
    "+---------------+                            ", "|               |                            ",
    "|               |                            ", "|               |                            ",
    "+---------------+                            ", "        |                                    ",
    "        |                                    ", "        |                                    ",
    "        |                                    ", "        v                                    ",
    "+---------------+                            ", "|               |                            ",
    "|     Closed    |   <----+-----------+       ", "|               |        |           |       ",
    "+---------------+        |           |       ", "        ^                |           |       ",
    "        |                |           |       ", "     timeout             |           |       ",
    "        |                |           |       ", "        v                |           v       ",
    "+---------------+        |   +--------------+", "|               |        |   |              |",
    "|   Connecting  |        |   |              |", "|               |        |   |              |",
    "+---------------+        |   +--------------+", "        |                |                   ",
    "        |                |                   ", "     success             |                   ",
    "        |                |                   ", "        v                |                   ",
    "+---------------+        +---+               ", "|               |        |   |               ",
    "|   Connected   |   <----|error------+       ", "|               |        |   |       |       ",
    "+---------------+        |   |       |       ", "        |                |   |       |       ",
    "        |                |   |    success    ", "      close              |   +-------+       ",
    "        |                |      max_retries  ", "        v                |           v       ",
    "+---------------+        |   +--------------+", "|               |        |   |              |",
    "| Disconnecting |   done-+   | Reconnecting |", "|               |            |              |",
    "+---------------+            +--------------+",
  ]
  .iter()
  .join("\n")
}

///|
fn state_connection_lifecycle_sample_expected_unicode() -> String {
  [
    "┌───────────────┐                            ",
    "│               │                            ", "│               │                            ",
    "│               │                            ", "└───────┬───────┘                            ",
    "        │                                    ", "        │                                    ",
    "        │                                    ", "        │                                    ",
    "        ▼                                    ", "┌───────────────┐                            ",
    "│               │                            ", "│     Closed    │  ├◄────┬───────────┐       ",
    "│               │        │           │       ", "└───────┬───────┘        │           │       ",
    "        ▲                │           │       ", "        │                │           │       ",
    "     timeout             │           │       ", "        │                │           │       ",
    "        ▼                │           ▼       ", "┌───────┴───────┐        │   ┌──────────────┐",
    "│               │        │   │              │", "│   Connecting  │        │   │              │",
    "│               │        │   │              │", "└───────┬───────┘        │   └──────────────┘",
    "        │                │                   ", "        │                │                   ",
    "     success             │                   ", "        │                │                   ",
    "        ▼                │                   ", "┌───────────────┐        ├───┐               ",
    "│               │        │   │               ", "│   Connected   │  ├◄────┼error──────┐       ",
    "│               │        │   │       │       ", "└───────┬───────┘        │   │       │       ",
    "        │                │   │       │       ", "        │                │   │    success    ",
    "      close              │   └───────┤       ", "        │                │      max_retries  ",
    "        ▼                │           ▼       ", "┌───────────────┐        │   ┌───────┴──────┐",
    "│               │        │   │              │", "│ Disconnecting │  ├done─┘   │ Reconnecting │",
    "│               │            │              │", "└───────────────┘            └──────────────┘",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_basic_messages_source() -> String {
  (
    #|sequenceDiagram
    #|  Alice->>Bob: Hello Bob!
    #|  Bob-->>Alice: Hi Alice!
  )
}

///|
fn sequence_basic_messages_expected_ascii() -> String {
  [
    " +-------+        +-----+   ", " | Alice |        | Bob |   ", " +-------+        +-----+   ",
    "     |               |      ", "     |  Hello Bob!   |      ", "     |--------------->      ",
    "     |               |      ", "     |   Hi Alice!   |      ", "     <...............|      ",
    "     |               |      ", " +-------+        +-----+   ", " | Alice |        | Bob |   ",
    " +-------+        +-----+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_basic_messages_expected_unicode() -> String {
  [
    " ┌───────┐        ┌─────┐   ", " │ Alice │        │ Bob │   ",
    " └───┬───┘        └──┬──┘   ", "     │               │      ",
    "     │  Hello Bob!   │      ", "     │───────────────▶      ",
    "     │               │      ", "     │   Hi Alice!   │      ", "     ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│      ",
    "     │               │      ", " ┌───┴───┐        ┌──┴──┐   ",
    " │ Alice │        │ Bob │   ", " └───────┘        └─────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_participant_aliases_source() -> String {
  (
    #|sequenceDiagram
    #|  participant A as Alice
    #|  participant B as Bob
    #|  participant C as Charlie
    #|  A->>B: Hello
    #|  B->>C: Forward
    #|  C-->>A: Reply
  )
}

///|
fn sequence_participant_aliases_expected_ascii() -> String {
  [
    " +-------+   +-----+    +---------+   ", " | Alice |   | Bob |    | Charlie |   ",
    " +-------+   +-----+    +---------+   ", "     |          |            |        ",
    "     |  Hello   |            |        ", "     |---------->            |        ",
    "     |          |            |        ", "     |          |  Forward   |        ",
    "     |          |------------>        ", "     |          |            |        ",
    "     |         Reply         |        ", "     <.......................|        ",
    "     |          |            |        ", " +-------+   +-----+    +---------+   ",
    " | Alice |   | Bob |    | Charlie |   ", " +-------+   +-----+    +---------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_participant_aliases_expected_unicode() -> String {
  [
    " ┌───────┐   ┌─────┐    ┌─────────┐   ",
    " │ Alice │   │ Bob │    │ Charlie │   ", " └───┬───┘   └──┬──┘    └────┬────┘   ",
    "     │          │            │        ", "     │  Hello   │            │        ",
    "     │──────────▶            │        ", "     │          │            │        ",
    "     │          │  Forward   │        ", "     │          │────────────▶        ",
    "     │          │            │        ", "     │         Reply         │        ",
    "     ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│        ",
    "     │          │            │        ", " ┌───┴───┐   ┌──┴──┐    ┌────┴────┐   ",
    " │ Alice │   │ Bob │    │ Charlie │   ", " └───────┘   └─────┘    └─────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_actor_stick_figures_source() -> String {
  (
    #|sequenceDiagram
    #|  actor U as User
    #|  participant S as System
    #|  participant DB as Database
    #|  U->>S: Click button
    #|  S->>DB: Query
    #|  DB-->>S: Results
    #|  S-->>U: Display
  )
}

///|
fn sequence_actor_stick_figures_expected_ascii() -> String {
  [
    "+------+         +--------+  +----------+   ", "| User |         | System |  | Database |   ",
    "+------+         +--------+  +----------+   ", "    |                 |            |        ",
    "    |  Click button   |            |        ", "    |----------------->            |        ",
    "    |                 |            |        ", "    |                 |   Query    |        ",
    "    |                 |------------>        ", "    |                 |            |        ",
    "    |                 |  Results   |        ", "    |                 <............|        ",
    "    |                 |            |        ", "    |     Display     |            |        ",
    "    <.................|            |        ", "    |                 |            |        ",
    "+------+         +--------+  +----------+   ", "| User |         | System |  | Database |   ",
    "+------+         +--------+  +----------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_actor_stick_figures_expected_unicode() -> String {
  [
    "┌──────┐         ┌────────┐  ┌──────────┐   ",
    "│ User │         │ System │  │ Database │   ", "└───┬──┘         └────┬───┘  └─────┬────┘   ",
    "    │                 │            │        ", "    │  Click button   │            │        ",
    "    │─────────────────▶            │        ",
    "    │                 │            │        ", "    │                 │   Query    │        ",
    "    │                 │────────────▶        ",
    "    │                 │            │        ", "    │                 │  Results   │        ",
    "    │                 ◀╌╌╌╌╌╌╌╌╌╌╌╌│        ",
    "    │                 │            │        ", "    │     Display     │            │        ",
    "    ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│            │        ",
    "    │                 │            │        ", "┌───┴──┐         ┌────┴───┐  ┌─────┴────┐   ",
    "│ User │         │ System │  │ Database │   ", "└──────┘         └────────┘  └──────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_arrow_types_source() -> String {
  (
    #|sequenceDiagram
    #|  A->>B: Solid arrow (sync)
    #|  B-->>A: Dashed arrow (return)
    #|  A-)B: Open arrow (async)
    #|  B--)A: Open dashed arrow
  )
}

///|
fn sequence_arrow_types_expected_ascii() -> String {
  [
    " +---+                      +---+   ", " | A |                      | B |   ",
    " +---+                      +---+   ", "   |                          |     ",
    "   |   Solid arrow (sync)     |     ", "   |-------------------------->     ",
    "   |                          |     ", "   |  Dashed arrow (return)   |     ",
    "   <..........................|     ", "   |                          |     ",
    "   |   Open arrow (async)     |     ", "   |-------------------------->     ",
    "   |                          |     ", "   |    Open dashed arrow     |     ",
    "   <..........................|     ", "   |                          |     ",
    " +---+                      +---+   ", " | A |                      | B |   ",
    " +---+                      +---+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_arrow_types_expected_unicode() -> String {
  [
    " ┌───┐                      ┌───┐   ", " │ A │                      │ B │   ",
    " └─┬─┘                      └─┬─┘   ", "   │                          │     ",
    "   │   Solid arrow (sync)     │     ", "   │──────────────────────────▶     ",
    "   │                          │     ", "   │  Dashed arrow (return)   │     ",
    "   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│     ",
    "   │                          │     ", "   │   Open arrow (async)     │     ",
    "   │──────────────────────────▷     ",
    "   │                          │     ", "   │    Open dashed arrow     │     ",
    "   ◁╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│     ",
    "   │                          │     ", " ┌─┴─┐                      ┌─┴─┐   ",
    " │ A │                      │ B │   ", " └───┘                      └───┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_activation_boxes_sample_source() -> String {
  (
    #|sequenceDiagram
    #|  participant C as Client
    #|  participant S as Server
    #|  C->>+S: Request
    #|  S->>+S: Process
    #|  S->>-S: Done
    #|  S-->>-C: Response
  )
}

///|
fn sequence_activation_boxes_sample_expected_ascii() -> String {
  [
    "+--------+    +--------+            ", "| Client |    | Server |            ",
    "+--------+    +--------+            ", "     |             |                ",
    "     |   Request   |                ", "     |------------->                ",
    "     |             |                ", "     |             +---+            ",
    "     |             |   | Process    ", "     |             <---+            ",
    "     |             |                ", "     |             +---+            ",
    "     |             |   | Done       ", "     |             <---+            ",
    "     |             |                ", "     |  Response   |                ",
    "     <.............|                ", "     |             |                ",
    "+--------+    +--------+            ", "| Client |    | Server |            ",
    "+--------+    +--------+            ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_activation_boxes_sample_expected_unicode() -> String {
  [
    "┌────────┐    ┌────────┐            ",
    "│ Client │    │ Server │            ", "└────┬───┘    └────┬───┘            ",
    "     │             │                ", "     │   Request   │                ",
    "     │─────────────▶                ", "     │             │                ",
    "     │             ├───┐            ", "     │             │   │ Process    ",
    "     │             ◀───┘            ", "     │             │                ",
    "     │             ├───┐            ", "     │             │   │ Done       ",
    "     │             ◀───┘            ", "     │             │                ",
    "     │  Response   │                ", "     ◀╌╌╌╌╌╌╌╌╌╌╌╌╌│                ",
    "     │             │                ", "┌────┴───┐    ┌────┴───┐            ",
    "│ Client │    │ Server │            ", "└────────┘    └────────┘            ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_self_messages_source() -> String {
  (
    #|sequenceDiagram
    #|  participant S as Server
    #|  S->>S: Internal process
    #|  S->>S: Validate
    #|  S-->>S: Log
  )
}

///|
fn sequence_self_messages_expected_ascii() -> String {
  [
    "+--------+                     ", "| Server |                     ", "+--------+                     ",
    "     |                         ", "     +---+                     ", "     |   | Internal process    ",
    "     <---+                     ", "     |                         ", "     +---+                     ",
    "     |   | Validate            ", "     <---+                     ", "     |                         ",
    "     +...+                     ", "     |   | Log                 ", "     <...+                     ",
    "     |                         ", "+--------+                     ", "| Server |                     ",
    "+--------+                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_self_messages_expected_unicode() -> String {
  [
    "┌────────┐                     ", "│ Server │                     ",
    "└────┬───┘                     ", "     │                         ",
    "     ├───┐                     ", "     │   │ Internal process    ",
    "     ◀───┘                     ", "     │                         ",
    "     ├───┐                     ", "     │   │ Validate            ",
    "     ◀───┘                     ", "     │                         ",
    "     ├╌╌╌┐                     ", "     │   │ Log                 ",
    "     ◀╌╌╌┘                     ", "     │                         ",
    "┌────┴───┐                     ", "│ Server │                     ",
    "└────────┘                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_loop_block_source() -> String {
  (
    #|sequenceDiagram
    #|  participant C as Client
    #|  participant S as Server
    #|  C->>S: Connect
    #|  loop Every 30s
    #|    C->>S: Heartbeat
    #|    S-->>C: Ack
    #|  end
    #|  C->>S: Disconnect
  )
}

///|
fn sequence_loop_block_expected_ascii() -> String {
  [
    "+--------+      +--------+   ", "| Client |      | Server |   ", "+--------+      +--------+   ",
    "     |               |       ", "     |    Connect    |       ", "     |--------------->       ",
    "     |               |       ", " +loop [Every 30s]-------+   ", " |   |               |   |   ",
    " |   |   Heartbeat   |   |   ", " |   |--------------->   |   ", " |   |               |   |   ",
    " |   |      Ack      |   |   ", " |   <...............|   |   ", " |   |               |   |   ",
    " +-----------------------+   ", "     |               |       ", "     |  Disconnect   |       ",
    "     |--------------->       ", "     |               |       ", "+--------+      +--------+   ",
    "| Client |      | Server |   ", "+--------+      +--------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_loop_block_expected_unicode() -> String {
  [
    "┌────────┐      ┌────────┐   ", "│ Client │      │ Server │   ",
    "└────┬───┘      └────┬───┘   ", "     │               │       ",
    "     │    Connect    │       ", "     │───────────────▶       ",
    "     │               │       ", " ┌loop [Every 30s]───────┐   ",
    " │   │               │   │   ", " │   │   Heartbeat   │   │   ",
    " │   │───────────────▶   │   ", " │   │               │   │   ",
    " │   │      Ack      │   │   ", " │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│   │   ",
    " │   │               │   │   ", " └───────────────────────┘   ",
    "     │               │       ", "     │  Disconnect   │       ", "     │───────────────▶       ",
    "     │               │       ", "┌────┴───┐      ┌────┴───┐   ",
    "│ Client │      │ Server │   ", "└────────┘      └────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_alt_else_block_source() -> String {
  (
    #|sequenceDiagram
    #|  participant C as Client
    #|  participant S as Server
    #|  C->>S: Login
    #|  alt Valid credentials
    #|    S-->>C: 200 OK
    #|  else Invalid
    #|    S-->>C: 401 Unauthorized
    #|  else Account locked
    #|    S-->>C: 403 Forbidden
    #|  end
  )
}

///|
fn sequence_alt_else_block_expected_ascii() -> String {
  [
    "+--------+            +--------+   ", "| Client |            | Server |   ",
    "+--------+            +--------+   ", "     |                     |       ",
    "     |        Login        |       ", "     |--------------------->       ",
    "     |                     |       ", " +alt [Valid credentials]------+   ",
    " |   |                     |   |   ", " |   |       200 OK        |   |   ",
    " |   <.....................|   |   ", " |   |                     |   |   ",
    " +[Invalid]--------------------+   ", " |   |                     |   |   ",
    " |   |  401 Unauthorized   |   |   ", " |   <.....................|   |   ",
    " |   |                     |   |   ", " +[Account locked]-------------+   ",
    " |   |                     |   |   ", " |   |    403 Forbidden    |   |   ",
    " |   <.....................|   |   ", " |   |                     |   |   ",
    " +-----------------------------+   ", "     |                     |       ",
    "+--------+            +--------+   ", "| Client |            | Server |   ",
    "+--------+            +--------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_alt_else_block_expected_unicode() -> String {
  [
    "┌────────┐            ┌────────┐   ",
    "│ Client │            │ Server │   ", "└────┬───┘            └────┬───┘   ",
    "     │                     │       ", "     │        Login        │       ",
    "     │─────────────────────▶       ",
    "     │                     │       ", " ┌alt [Valid credentials]──────┐   ",
    " │   │                     │   │   ", " │   │       200 OK        │   │   ",
    " │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│   │   ",
    " │   │                     │   │   ", " ├[Invalid]╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤   ",
    " │   │                     │   │   ", " │   │  401 Unauthorized   │   │   ",
    " │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│   │   ",
    " │   │                     │   │   ", " ├[Account locked]╌╌╌╌╌╌╌╌╌╌╌╌╌┤   ",
    " │   │                     │   │   ", " │   │    403 Forbidden    │   │   ",
    " │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│   │   ",
    " │   │                     │   │   ", " └─────────────────────────────┘   ",
    "     │                     │       ", "┌────┴───┐            ┌────┴───┐   ",
    "│ Client │            │ Server │   ", "└────────┘            └────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_opt_block_source() -> String {
  (
    #|sequenceDiagram
    #|  participant A as App
    #|  participant C as Cache
    #|  participant DB as Database
    #|  A->>C: Get data
    #|  C-->>A: Cache miss
    #|  opt Cache miss
    #|    A->>DB: Query
    #|    DB-->>A: Results
    #|    A->>C: Store in cache
    #|  end
  )
}

///|
fn sequence_opt_block_expected_ascii() -> String {
  [
    " +-----+            +-------+  +----------+   ", " | App |            | Cache |  | Database |   ",
    " +-----+            +-------+  +----------+   ", "    |                   |            |        ",
    "    |     Get data      |            |        ", "    |------------------->            |        ",
    "    |                   |            |        ", "    |    Cache miss     |            |        ",
    "    <...................|            |        ", "    |                   |            |        ",
    "+opt [Cache miss]------------------------+    ", "|   |                   |            |   |    ",
    "|   |             Query |            |   |    ", "|   |-------------------------------->   |    ",
    "|   |                   |            |   |    ", "|   |            Results|            |   |    ",
    "|   <................................|   |    ", "|   |                   |            |   |    ",
    "|   |  Store in cache   |            |   |    ", "|   |------------------->            |   |    ",
    "|   |                   |            |   |    ", "+----------------------------------------+    ",
    "    |                   |            |        ", " +-----+            +-------+  +----------+   ",
    " | App |            | Cache |  | Database |   ", " +-----+            +-------+  +----------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_opt_block_expected_unicode() -> String {
  [
    " ┌─────┐            ┌───────┐  ┌──────────┐   ",
    " │ App │            │ Cache │  │ Database │   ", " └──┬──┘            └───┬───┘  └─────┬────┘   ",
    "    │                   │            │        ", "    │     Get data      │            │        ",
    "    │───────────────────▶            │        ",
    "    │                   │            │        ", "    │    Cache miss     │            │        ",
    "    ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│            │        ",
    "    │                   │            │        ", "┌opt [Cache miss]────────────────────────┐    ",
    "│   │                   │            │   │    ", "│   │             Query │            │   │    ",
    "│   │────────────────────────────────▶   │    ",
    "│   │                   │            │   │    ", "│   │            Results│            │   │    ",
    "│   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│   │    ",
    "│   │                   │            │   │    ", "│   │  Store in cache   │            │   │    ",
    "│   │───────────────────▶            │   │    ",
    "│   │                   │            │   │    ", "└────────────────────────────────────────┘    ",
    "    │                   │            │        ", " ┌──┴──┐            ┌───┴───┐  ┌─────┴────┐   ",
    " │ App │            │ Cache │  │ Database │   ", " └─────┘            └───────┘  └──────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_par_block_source() -> String {
  (
    #|sequenceDiagram
    #|  participant C as Client
    #|  participant A as AuthService
    #|  participant U as UserService
    #|  participant O as OrderService
    #|  C->>A: Authenticate
    #|  par Fetch user data
    #|    A->>U: Get profile
    #|  and Fetch orders
    #|    A->>O: Get orders
    #|  end
    #|  A-->>C: Combined response
  )
}

///|
fn sequence_par_block_expected_ascii() -> String {
  [
    "+--------+           +-------------+   +-------------+  +--------------+   ",
    "| Client |           | AuthService |   | UserService |  | OrderService |   ",
    "+--------+           +-------------+   +-------------+  +--------------+   ",
    "     |                      |                 |                 |          ",
    "     |    Authenticate      |                 |                 |          ",
    "     |---------------------->                 |                 |          ",
    "     |                      |                 |                 |          ",
    "     |                  +par [Fetch user data]----------------------+      ",
    "     |                  |   |                 |                 |   |      ",
    "     |                  |   |   Get profile   |                 |   |      ",
    "     |                  |   |----------------->                 |   |      ",
    "     |                  |   |                 |                 |   |      ",
    "     |                  +[Fetch orders]-----------------------------+      ",
    "     |                  |   |                 |                 |   |      ",
    "     |                  |   |            Get orders             |   |      ",
    "     |                  |   |----------------------------------->   |      ",
    "     |                  |   |                 |                 |   |      ",
    "     |                  +-------------------------------------------+      ",
    "     |                      |                 |                 |          ",
    "     |  Combined response   |                 |                 |          ",
    "     <......................|                 |                 |          ",
    "     |                      |                 |                 |          ",
    "+--------+           +-------------+   +-------------+  +--------------+   ",
    "| Client |           | AuthService |   | UserService |  | OrderService |   ",
    "+--------+           +-------------+   +-------------+  +--------------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_par_block_expected_unicode() -> String {
  [
    "┌────────┐           ┌─────────────┐   ┌─────────────┐  ┌──────────────┐   ",
    "│ Client │           │ AuthService │   │ UserService │  │ OrderService │   ",
    "└────┬───┘           └──────┬──────┘   └──────┬──────┘  └───────┬──────┘   ",
    "     │                      │                 │                 │          ",
    "     │    Authenticate      │                 │                 │          ",
    "     │──────────────────────▶                 │                 │          ",
    "     │                      │                 │                 │          ",
    "     │                  ┌par [Fetch user data]──────────────────────┐      ",
    "     │                  │   │                 │                 │   │      ",
    "     │                  │   │   Get profile   │                 │   │      ",
    "     │                  │   │─────────────────▶                 │   │      ",
    "     │                  │   │                 │                 │   │      ",
    "     │                  ├[Fetch orders]╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤      ",
    "     │                  │   │                 │                 │   │      ",
    "     │                  │   │            Get orders             │   │      ",
    "     │                  │   │───────────────────────────────────▶   │      ",
    "     │                  │   │                 │                 │   │      ",
    "     │                  └───────────────────────────────────────────┘      ",
    "     │                      │                 │                 │          ",
    "     │  Combined response   │                 │                 │          ",
    "     ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                 │                 │          ",
    "     │                      │                 │                 │          ",
    "┌────┴───┐           ┌──────┴──────┐   ┌──────┴──────┐  ┌───────┴──────┐   ",
    "│ Client │           │ AuthService │   │ UserService │  │ OrderService │   ",
    "└────────┘           └─────────────┘   └─────────────┘  └──────────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_critical_block_source() -> String {
  (
    #|sequenceDiagram
    #|  participant A as App
    #|  participant DB as Database
    #|  A->>DB: BEGIN
    #|  critical Transaction
    #|    A->>DB: UPDATE accounts
    #|    A->>DB: INSERT log
    #|  end
    #|  A->>DB: COMMIT
  )
}

///|
fn sequence_critical_block_expected_ascii() -> String {
  [
    " +-----+           +----------+   ", " | App |           | Database |   ", " +-----+           +----------+   ",
    "    |                    |        ", "    |       BEGIN        |        ", "    |-------------------->        ",
    "    |                    |        ", "+critical [Transaction]------+    ", "|   |                    |   |    ",
    "|   |  UPDATE accounts   |   |    ", "|   |-------------------->   |    ", "|   |                    |   |    ",
    "|   |    INSERT log      |   |    ", "|   |-------------------->   |    ", "|   |                    |   |    ",
    "+----------------------------+    ", "    |                    |        ", "    |      COMMIT        |        ",
    "    |-------------------->        ", "    |                    |        ", " +-----+           +----------+   ",
    " | App |           | Database |   ", " +-----+           +----------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_critical_block_expected_unicode() -> String {
  [
    " ┌─────┐           ┌──────────┐   ", " │ App │           │ Database │   ",
    " └──┬──┘           └─────┬────┘   ", "    │                    │        ",
    "    │       BEGIN        │        ", "    │────────────────────▶        ",
    "    │                    │        ", "┌critical [Transaction]──────┐    ",
    "│   │                    │   │    ", "│   │  UPDATE accounts   │   │    ",
    "│   │────────────────────▶   │    ",
    "│   │                    │   │    ", "│   │    INSERT log      │   │    ",
    "│   │────────────────────▶   │    ",
    "│   │                    │   │    ", "└────────────────────────────┘    ",
    "    │                    │        ", "    │      COMMIT        │        ",
    "    │────────────────────▶        ",
    "    │                    │        ", " ┌──┴──┐           ┌─────┴────┐   ",
    " │ App │           │ Database │   ", " └─────┘           └──────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_notes_right_left_over_source() -> String {
  (
    #|sequenceDiagram
    #|  participant A as Alice
    #|  participant B as Bob
    #|  Note left of A: Alice prepares
    #|  A->>B: Hello
    #|  Note right of B: Bob thinks
    #|  B-->>A: Reply
    #|  Note over A,B: Conversation complete
  )
}

///|
fn sequence_notes_right_left_over_expected_ascii() -> String {
  [
    " +-------+   +-----+              ", " | Alice |   | Bob |              ", " +-------+   +-----+              ",
    "     |          |                 ", "     |  Hello   |                 ", "     |---------->                 ",
    "     |          |                 ", "     |          | +------------+  ", "     |          | | Bob thinks |  ",
    "     |          | +------------+  ", "     |          |                 ", "     |  Reply   |                 ",
    "     <..........|                 ", "     |          |                 ", "+-----------------------+         ",
    "| Conversation complete |         ", "+-----------------------+         ", "     |          |                 ",
    " +-------+   +-----+              ", " | Alice |   | Bob |              ", " +-------+   +-----+              ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_notes_right_left_over_expected_unicode() -> String {
  [
    " ┌───────┐   ┌─────┐              ", " │ Alice │   │ Bob │              ",
    " └───┬───┘   └──┬──┘              ", "     │          │                 ",
    "     │  Hello   │                 ", "     │──────────▶                 ",
    "     │          │                 ", "     │          │ ┌────────────┐  ",
    "     │          │ │ Bob thinks │  ", "     │          │ └────────────┘  ",
    "     │          │                 ", "     │  Reply   │                 ",
    "     ◀╌╌╌╌╌╌╌╌╌╌│                 ", "     │          │                 ",
    "┌───────────────────────┐         ",
    "│ Conversation complete │         ", "└───────────────────────┘         ",
    "     │          │                 ", " ┌───┴───┐   ┌──┴──┐              ",
    " │ Alice │   │ Bob │              ", " └───────┘   └─────┘              ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_oauth_2_0_flow_source() -> String {
  (
    #|sequenceDiagram
    #|  actor U as User
    #|  participant App as Client App
    #|  participant Auth as Auth Server
    #|  participant API as Resource API
    #|  U->>App: Click Login
    #|  App->>Auth: Authorization request
    #|  Auth->>U: Login page
    #|  U->>Auth: Credentials
    #|  Auth-->>App: Authorization code
    #|  App->>Auth: Exchange code for token
    #|  Auth-->>App: Access token
    #|  App->>API: Request + token
    #|  API-->>App: Protected resource
    #|  App-->>U: Display data
  )
}

///|
fn sequence_oauth_2_0_flow_expected_ascii() -> String {
  [
    "+------+       +------------+               +-------------+  +--------------+   ",
    "| User |       | Client App |               | Auth Server |  | Resource API |   ",
    "+------+       +------------+               +-------------+  +--------------+   ",
    "    |                 |                            |                 |          ",
    "    |   Click Login   |                            |                 |          ",
    "    |----------------->                            |                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 |   Authorization request    |                 |          ",
    "    |                 |---------------------------->                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 Login page                   |                 |          ",
    "    <----------------------------------------------|                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 Credentials                  |                 |          ",
    "    |---------------------------------------------->                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 |    Authorization code      |                 |          ",
    "    |                 <............................|                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 |  Exchange code for token   |                 |          ",
    "    |                 |---------------------------->                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 |       Access token         |                 |          ",
    "    |                 <............................|                 |          ",
    "    |                 |                            |                 |          ",
    "    |                 |               Request + token                |          ",
    "    |                 |---------------------------------------------->          ",
    "    |                 |                            |                 |          ",
    "    |                 |             Protected resource               |          ",
    "    |                 <..............................................|          ",
    "    |                 |                            |                 |          ",
    "    |  Display data   |                            |                 |          ",
    "    <.................|                            |                 |          ",
    "    |                 |                            |                 |          ",
    "+------+       +------------+               +-------------+  +--------------+   ",
    "| User |       | Client App |               | Auth Server |  | Resource API |   ",
    "+------+       +------------+               +-------------+  +--------------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_oauth_2_0_flow_expected_unicode() -> String {
  [
    "┌──────┐       ┌────────────┐               ┌─────────────┐  ┌──────────────┐   ",
    "│ User │       │ Client App │               │ Auth Server │  │ Resource API │   ",
    "└───┬──┘       └──────┬─────┘               └──────┬──────┘  └───────┬──────┘   ",
    "    │                 │                            │                 │          ",
    "    │   Click Login   │                            │                 │          ",
    "    │─────────────────▶                            │                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 │   Authorization request    │                 │          ",
    "    │                 │────────────────────────────▶                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 Login page                   │                 │          ",
    "    ◀──────────────────────────────────────────────│                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 Credentials                  │                 │          ",
    "    │──────────────────────────────────────────────▶                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 │    Authorization code      │                 │          ",
    "    │                 ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 │  Exchange code for token   │                 │          ",
    "    │                 │────────────────────────────▶                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 │       Access token         │                 │          ",
    "    │                 ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                 │          ",
    "    │                 │                            │                 │          ",
    "    │                 │               Request + token                │          ",
    "    │                 │──────────────────────────────────────────────▶          ",
    "    │                 │                            │                 │          ",
    "    │                 │             Protected resource               │          ",
    "    │                 ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│          ",
    "    │                 │                            │                 │          ",
    "    │  Display data   │                            │                 │          ",
    "    ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                            │                 │          ",
    "    │                 │                            │                 │          ",
    "┌───┴──┐       ┌──────┴─────┐               ┌──────┴──────┐  ┌───────┴──────┐   ",
    "│ User │       │ Client App │               │ Auth Server │  │ Resource API │   ",
    "└──────┘       └────────────┘               └─────────────┘  └──────────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_database_transaction_source() -> String {
  (
    #|sequenceDiagram
    #|  participant C as Client
    #|  participant S as Server
    #|  participant DB as Database
    #|  C->>S: POST /transfer
    #|  S->>DB: BEGIN
    #|  S->>DB: Debit account A
    #|  alt Success
    #|    S->>DB: Credit account B
    #|    S->>DB: INSERT audit_log
    #|    S->>DB: COMMIT
    #|    S-->>C: 200 OK
    #|  else Insufficient funds
    #|    S->>DB: ROLLBACK
    #|    S-->>C: 400 Bad Request
    #|  end
  )
}

///|
fn sequence_database_transaction_expected_ascii() -> String {
  [
    "+--------+           +--------+           +----------+   ", "| Client |           | Server |           | Database |   ",
    "+--------+           +--------+           +----------+   ", "     |                    |                     |        ",
    "     |  POST /transfer    |                     |        ", "     |-------------------->                     |        ",
    "     |                    |                     |        ", "     |                    |        BEGIN        |        ",
    "     |                    |--------------------->        ", "     |                    |                     |        ",
    "     |                    |   Debit account A   |        ", "     |                    |--------------------->        ",
    "     |                    |                     |        ", " +alt [Success]-------------------------------------+    ",
    " |   |                    |                     |   |    ", " |   |                    |  Credit account B   |   |    ",
    " |   |                    |--------------------->   |    ", " |   |                    |                     |   |    ",
    " |   |                    |  INSERT audit_log   |   |    ", " |   |                    |--------------------->   |    ",
    " |   |                    |                     |   |    ", " |   |                    |       COMMIT        |   |    ",
    " |   |                    |--------------------->   |    ", " |   |                    |                     |   |    ",
    " |   |      200 OK        |                     |   |    ", " |   <....................|                     |   |    ",
    " |   |                    |                     |   |    ", " +[Insufficient funds]------------------------------+    ",
    " |   |                    |                     |   |    ", " |   |                    |      ROLLBACK       |   |    ",
    " |   |                    |--------------------->   |    ", " |   |                    |                     |   |    ",
    " |   |  400 Bad Request   |                     |   |    ", " |   <....................|                     |   |    ",
    " |   |                    |                     |   |    ", " +--------------------------------------------------+    ",
    "     |                    |                     |        ", "+--------+           +--------+           +----------+   ",
    "| Client |           | Server |           | Database |   ", "+--------+           +--------+           +----------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_database_transaction_expected_unicode() -> String {
  [
    "┌────────┐           ┌────────┐           ┌──────────┐   ",
    "│ Client │           │ Server │           │ Database │   ", "└────┬───┘           └────┬───┘           └─────┬────┘   ",
    "     │                    │                     │        ", "     │  POST /transfer    │                     │        ",
    "     │────────────────────▶                     │        ",
    "     │                    │                     │        ", "     │                    │        BEGIN        │        ",
    "     │                    │─────────────────────▶        ",
    "     │                    │                     │        ", "     │                    │   Debit account A   │        ",
    "     │                    │─────────────────────▶        ",
    "     │                    │                     │        ", " ┌alt [Success]─────────────────────────────────────┐    ",
    " │   │                    │                     │   │    ", " │   │                    │  Credit account B   │   │    ",
    " │   │                    │─────────────────────▶   │    ",
    " │   │                    │                     │   │    ", " │   │                    │  INSERT audit_log   │   │    ",
    " │   │                    │─────────────────────▶   │    ",
    " │   │                    │                     │   │    ", " │   │                    │       COMMIT        │   │    ",
    " │   │                    │─────────────────────▶   │    ",
    " │   │                    │                     │   │    ", " │   │      200 OK        │                     │   │    ",
    " │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                     │   │    ",
    " │   │                    │                     │   │    ", " ├[Insufficient funds]╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤    ",
    " │   │                    │                     │   │    ", " │   │                    │      ROLLBACK       │   │    ",
    " │   │                    │─────────────────────▶   │    ",
    " │   │                    │                     │   │    ", " │   │  400 Bad Request   │                     │   │    ",
    " │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                     │   │    ",
    " │   │                    │                     │   │    ", " └──────────────────────────────────────────────────┘    ",
    "     │                    │                     │        ", "┌────┴───┐           ┌────┴───┐           ┌─────┴────┐   ",
    "│ Client │           │ Server │           │ Database │   ", "└────────┘           └────────┘           └──────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_microservice_orchestration_source() -> String {
  (
    #|sequenceDiagram
    #|  participant G as Gateway
    #|  participant A as Auth
    #|  participant U as Users
    #|  participant O as Orders
    #|  participant N as Notify
    #|  G->>A: Validate token
    #|  A-->>G: Valid
    #|  par Fetch data
    #|    G->>U: Get user
    #|    U-->>G: User data
    #|  and
    #|    G->>O: Get orders
    #|    O-->>G: Order list
    #|  end
    #|  G->>N: Send notification
    #|  N-->>G: Queued
    #|  Note over G: Aggregate response
  )
}

///|
fn sequence_microservice_orchestration_expected_ascii() -> String {
  [
    " +---------+          +------+   +-------+  +--------+  +--------+   ", " | Gateway |          | Auth |   | Users |  | Orders |  | Notify |   ",
    " +---------+          +------+   +-------+  +--------+  +--------+   ", "      |                   |          |           |           |       ",
    "      |  Validate token   |          |           |           |       ", "      |------------------->          |           |           |       ",
    "      |                   |          |           |           |       ", "      |       Valid       |          |           |           |       ",
    "      <...................|          |           |           |       ", "      |                   |          |           |           |       ",
    "  +par [Fetch data]----------------------------------+       |       ", "  |   |                   |          |           |   |       |       ",
    "  |   |          Get user |          |           |   |       |       ", "  |   |------------------------------>           |   |       |       ",
    "  |   |                   |          |           |   |       |       ", "  |   |          User data|          |           |   |       |       ",
    "  |   <..............................|           |   |       |       ", "  |   |                   |          |           |   |       |       ",
    "  +--------------------------------------------------+       |       ", "  |   |                   |          |           |   |       |       ",
    "  |   |               Get orders     |           |   |       |       ", "  |   |------------------------------------------>   |       |       ",
    "  |   |                   |          |           |   |       |       ", "  |   |               Order list     |           |   |       |       ",
    "  |   <..........................................|   |       |       ", "  |   |                   |          |           |   |       |       ",
    "  +--------------------------------------------------+       |       ", "      |                   |          |           |           |       ",
    "      |                  Send notification       |           |       ", "      |------------------------------------------------------>       ",
    "      |                   |          |           |           |       ", "      |                   |   Queued |           |           |       ",
    "      <......................................................|       ", "      |                   |          |           |           |       ",
    "+--------------------+    |          |           |           |       ", "| Aggregate response |    |          |           |           |       ",
    "+--------------------+    |          |           |           |       ", "      |                   |          |           |           |       ",
    " +---------+          +------+   +-------+  +--------+  +--------+   ", " | Gateway |          | Auth |   | Users |  | Orders |  | Notify |   ",
    " +---------+          +------+   +-------+  +--------+  +--------+   ",
  ]
  .iter()
  .join("\n")
}

///|
fn sequence_microservice_orchestration_expected_unicode() -> String {
  [
    " ┌─────────┐          ┌──────┐   ┌───────┐  ┌────────┐  ┌────────┐   ",
    " │ Gateway │          │ Auth │   │ Users │  │ Orders │  │ Notify │   ",
    " └────┬────┘          └───┬──┘   └───┬───┘  └────┬───┘  └────┬───┘   ",
    "      │                   │          │           │           │       ",
    "      │  Validate token   │          │           │           │       ",
    "      │───────────────────▶          │           │           │       ",
    "      │                   │          │           │           │       ",
    "      │       Valid       │          │           │           │       ",
    "      ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│          │           │           │       ",
    "      │                   │          │           │           │       ",
    "  ┌par [Fetch data]──────────────────────────────────┐       │       ",
    "  │   │                   │          │           │   │       │       ",
    "  │   │          Get user │          │           │   │       │       ",
    "  │   │──────────────────────────────▶           │   │       │       ",
    "  │   │                   │          │           │   │       │       ",
    "  │   │          User data│          │           │   │       │       ",
    "  │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│           │   │       │       ",
    "  │   │                   │          │           │   │       │       ",
    "  ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤       │       ",
    "  │   │                   │          │           │   │       │       ",
    "  │   │               Get orders     │           │   │       │       ",
    "  │   │──────────────────────────────────────────▶   │       │       ",
    "  │   │                   │          │           │   │       │       ",
    "  │   │               Order list     │           │   │       │       ",
    "  │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│   │       │       ",
    "  │   │                   │          │           │   │       │       ",
    "  └──────────────────────────────────────────────────┘       │       ",
    "      │                   │          │           │           │       ",
    "      │                  Send notification       │           │       ",
    "      │──────────────────────────────────────────────────────▶       ",
    "      │                   │          │           │           │       ",
    "      │                   │   Queued │           │           │       ",
    "      ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│       ",
    "      │                   │          │           │           │       ",
    "┌────────────────────┐    │          │           │           │       ",
    "│ Aggregate response │    │          │           │           │       ",
    "└────────────────────┘    │          │           │           │       ",
    "      │                   │          │           │           │       ",
    " ┌────┴────┐          ┌───┴──┐   ┌───┴───┐  ┌────┴───┐  ┌────┴───┐   ",
    " │ Gateway │          │ Auth │   │ Users │  │ Orders │  │ Notify │   ",
    " └─────────┘          └──────┘   └───────┘  └────────┘  └────────┘   ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_basic_class_sample_source() -> String {
  (
    #|classDiagram
    #|  class Animal {
    #|    +String name
    #|    +int age
    #|    +eat() void
    #|    +sleep() void
    #|  }
  )
}

///|
fn class_basic_class_sample_expected_ascii() -> String {
  [
    "+---------------+    ", "| Animal        |    ", "+---------------+    ", "| +name: String |    ",
    "| +age: int     |    ", "+---------------+    ", "| +eat: void    |    ", "| +sleep: void  |    ",
    "+---------------+    ", "                     ", "                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_basic_class_sample_expected_unicode() -> String {
  [
    "┌───────────────┐    ", "│ Animal        │    ",
    "├───────────────┤    ", "│ +name: String │    ",
    "│ +age: int     │    ", "├───────────────┤    ",
    "│ +eat: void    │    ", "│ +sleep: void  │    ", "└───────────────┘    ",
    "                     ", "                     ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Beautiful Mermaid sample" {
  assert_text_parity(
    beautiful_mermaid_source(),
    beautiful_mermaid_expected_ascii(),
    beautiful_mermaid_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Git Branching Workflow sample" {
  assert_text_parity(
    git_branching_workflow_source(),
    git_branching_workflow_expected_ascii(),
    git_branching_workflow_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Subgraph Direction Override sample" {
  assert_text_parity(
    subgraph_direction_override_source(),
    subgraph_direction_override_expected_ascii(),
    subgraph_direction_override_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: CI/CD Pipeline sample" {
  assert_text_parity(
    ci_cd_pipeline_source(),
    ci_cd_pipeline_expected_ascii(),
    ci_cd_pipeline_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Decision Tree sample" {
  assert_text_parity(
    decision_tree_source(),
    decision_tree_expected_ascii(),
    decision_tree_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: System Architecture sample" {
  assert_text_parity(
    system_architecture_source(),
    system_architecture_expected_ascii(),
    system_architecture_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Subgraphs sample" {
  assert_text_parity(
    subgraphs_source(),
    subgraphs_expected_ascii(),
    subgraphs_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Nested Subgraphs sample" {
  assert_text_parity(
    nested_subgraphs_source(),
    nested_subgraphs_expected_ascii(),
    nested_subgraphs_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Simple Flow sample" {
  assert_text_parity(
    simple_flow_source(),
    simple_flow_expected_ascii(),
    simple_flow_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Original Node Shapes sample" {
  assert_text_parity(
    original_node_shapes_source(),
    original_node_shapes_expected_ascii(),
    original_node_shapes_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Batch 1 Shapes sample" {
  assert_text_parity(
    batch_1_shapes_source(),
    batch_1_shapes_expected_ascii(),
    batch_1_shapes_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Batch 2 Shapes sample" {
  assert_text_parity(
    batch_2_shapes_source(),
    batch_2_shapes_expected_ascii(),
    batch_2_shapes_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: All Edge Styles sample" {
  assert_text_parity(
    all_edge_styles_source(),
    all_edge_styles_expected_ascii(),
    all_edge_styles_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: No-Arrow Edges sample" {
  assert_text_parity(
    no_arrow_edges_source(),
    no_arrow_edges_expected_ascii(),
    no_arrow_edges_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Bidirectional Arrows sample" {
  assert_text_parity(
    bidirectional_arrows_source(),
    bidirectional_arrows_expected_ascii(),
    bidirectional_arrows_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Parallel Links (&) sample" {
  assert_text_parity(
    parallel_links_and_source(),
    parallel_links_and_expected_ascii(),
    parallel_links_and_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Chained Edges sample" {
  assert_text_parity(
    chained_edges_source(),
    chained_edges_expected_ascii(),
    chained_edges_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Direction: Left-Right (LR) sample" {
  assert_text_parity(
    direction_left_right_lr_source(),
    direction_left_right_lr_expected_ascii(),
    direction_left_right_lr_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Direction: Bottom-Top (BT) sample" {
  assert_text_parity(
    direction_bottom_top_bt_source(),
    direction_bottom_top_bt_expected_ascii(),
    direction_bottom_top_bt_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: All 12 Flowchart Shapes sample" {
  assert_text_parity(
    all_12_flowchart_shapes_source(),
    all_12_flowchart_shapes_expected_ascii(),
    all_12_flowchart_shapes_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: ::: Class Shorthand sample" {
  assert_text_parity(
    class_shorthand_source(),
    class_shorthand_expected_ascii(),
    class_shorthand_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Inline Style Overrides sample" {
  assert_text_parity(
    inline_style_overrides_source(),
    inline_style_overrides_expected_ascii(),
    inline_style_overrides_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Basic State Diagram sample" {
  assert_text_parity(
    basic_state_diagram_source(),
    basic_state_diagram_expected_ascii(),
    basic_state_diagram_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: State: Composite States sample" {
  assert_text_parity(
    state_composite_states_source(),
    state_composite_states_expected_ascii(),
    state_composite_states_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: State: Connection Lifecycle sample" {
  assert_text_parity(
    state_connection_lifecycle_sample_source(),
    state_connection_lifecycle_sample_expected_ascii(),
    state_connection_lifecycle_sample_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Basic Messages sample" {
  assert_text_parity(
    sequence_basic_messages_source(),
    sequence_basic_messages_expected_ascii(),
    sequence_basic_messages_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Participant Aliases sample" {
  assert_text_parity(
    sequence_participant_aliases_source(),
    sequence_participant_aliases_expected_ascii(),
    sequence_participant_aliases_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Actor Stick Figures sample" {
  assert_text_parity(
    sequence_actor_stick_figures_source(),
    sequence_actor_stick_figures_expected_ascii(),
    sequence_actor_stick_figures_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Arrow Types sample" {
  assert_text_parity(
    sequence_arrow_types_source(),
    sequence_arrow_types_expected_ascii(),
    sequence_arrow_types_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Activation Boxes sample" {
  assert_text_parity(
    sequence_activation_boxes_sample_source(),
    sequence_activation_boxes_sample_expected_ascii(),
    sequence_activation_boxes_sample_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Self-Messages sample" {
  assert_text_parity(
    sequence_self_messages_source(),
    sequence_self_messages_expected_ascii(),
    sequence_self_messages_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Loop Block sample" {
  assert_text_parity(
    sequence_loop_block_source(),
    sequence_loop_block_expected_ascii(),
    sequence_loop_block_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Alt/Else Block sample" {
  assert_text_parity(
    sequence_alt_else_block_source(),
    sequence_alt_else_block_expected_ascii(),
    sequence_alt_else_block_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Opt Block sample" {
  assert_text_parity(
    sequence_opt_block_source(),
    sequence_opt_block_expected_ascii(),
    sequence_opt_block_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Par Block sample" {
  assert_text_parity(
    sequence_par_block_source(),
    sequence_par_block_expected_ascii(),
    sequence_par_block_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Critical Block sample" {
  assert_text_parity(
    sequence_critical_block_source(),
    sequence_critical_block_expected_ascii(),
    sequence_critical_block_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Notes (Right/Left/Over) sample" {
  assert_text_parity(
    sequence_notes_right_left_over_source(),
    sequence_notes_right_left_over_expected_ascii(),
    sequence_notes_right_left_over_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: OAuth 2.0 Flow sample" {
  assert_text_parity(
    sequence_oauth_2_0_flow_source(),
    sequence_oauth_2_0_flow_expected_ascii(),
    sequence_oauth_2_0_flow_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Database Transaction sample" {
  assert_text_parity(
    sequence_database_transaction_source(),
    sequence_database_transaction_expected_ascii(),
    sequence_database_transaction_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Sequence: Microservice Orchestration sample" {
  assert_text_parity(
    sequence_microservice_orchestration_source(),
    sequence_microservice_orchestration_expected_ascii(),
    sequence_microservice_orchestration_expected_unicode(),
  )
}

///|
test "ASCII/Unicode parity regression: Class: Basic Class sample" {
  assert_text_parity(
    class_basic_class_sample_source(),
    class_basic_class_sample_expected_ascii(),
    class_basic_class_sample_expected_unicode(),
  )
}

///|
fn class_visibility_markers_sample_source() -> String {
  (
    #|classDiagram
    #|  class User {
    #|    +String name
    #|    -String password
    #|    #int internalId
    #|    ~String packageField
    #|    +login() bool
    #|    -hashPassword() String
    #|    #validate() void
    #|    ~notify() void
    #|  }
  )
}

///|
fn class_visibility_markers_sample_expected_ascii() -> String {
  [
    "+-----------------------+    ", "| User                  |    ", "+-----------------------+    ",
    "| +name: String         |    ", "| -password: String     |    ", "| #internalId: int      |    ",
    "| ~packageField: String |    ", "+-----------------------+    ", "| +login: bool          |    ",
    "| -hashPassword: String |    ", "| #validate: void       |    ", "| ~notify: void         |    ",
    "+-----------------------+    ", "                             ", "                             ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_visibility_markers_sample_expected_unicode() -> String {
  [
    "┌───────────────────────┐    ",
    "│ User                  │    ", "├───────────────────────┤    ",
    "│ +name: String         │    ", "│ -password: String     │    ", "│ #internalId: int      │    ",
    "│ ~packageField: String │    ", "├───────────────────────┤    ",
    "│ +login: bool          │    ", "│ -hashPassword: String │    ", "│ #validate: void       │    ",
    "│ ~notify: void         │    ", "└───────────────────────┘    ",
    "                             ", "                             ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Visibility Markers sample" {
  assert_text_parity(
    class_visibility_markers_sample_source(),
    class_visibility_markers_sample_expected_ascii(),
    class_visibility_markers_sample_expected_unicode(),
  )
}

///|
fn class_interface_annotation_sample_source() -> String {
  (
    #|classDiagram
    #|  class Serializable {
    #|    <<interface>>
    #|    +serialize() String
    #|    +deserialize(data) void
    #|  }
  )
}

///|
fn class_interface_annotation_sample_expected_ascii() -> String {
  [
    "+--------------------+    ", "| <<interface>>      |    ", "| Serializable       |    ",
    "+--------------------+    ", "|                    |    ", "+--------------------+    ",
    "| +serialize: String |    ", "| +deserialize: void |    ", "+--------------------+    ",
    "                          ", "                          ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_interface_annotation_sample_expected_unicode() -> String {
  [
    "┌────────────────────┐    ", "│ <<interface>>      │    ",
    "│ Serializable       │    ", "├────────────────────┤    ",
    "│                    │    ", "├────────────────────┤    ",
    "│ +serialize: String │    ", "│ +deserialize: void │    ", "└────────────────────┘    ",
    "                          ", "                          ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Interface Annotation sample" {
  assert_text_parity(
    class_interface_annotation_sample_source(),
    class_interface_annotation_sample_expected_ascii(),
    class_interface_annotation_sample_expected_unicode(),
  )
}

///|
fn class_abstract_annotation_sample_source() -> String {
  (
    #|classDiagram
    #|  class Shape {
    #|    <<abstract>>
    #|    +String color
    #|    +area() double
    #|    +draw() void
    #|  }
  )
}

///|
fn class_abstract_annotation_sample_expected_ascii() -> String {
  [
    "+----------------+    ", "| <<abstract>>   |    ", "| Shape          |    ",
    "+----------------+    ", "| +color: String |    ", "+----------------+    ",
    "| +area: double  |    ", "| +draw: void    |    ", "+----------------+    ",
    "                      ", "                      ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_abstract_annotation_sample_expected_unicode() -> String {
  [
    "┌────────────────┐    ", "│ <<abstract>>   │    ",
    "│ Shape          │    ", "├────────────────┤    ",
    "│ +color: String │    ", "├────────────────┤    ",
    "│ +area: double  │    ", "│ +draw: void    │    ", "└────────────────┘    ",
    "                      ", "                      ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Abstract Annotation sample" {
  assert_text_parity(
    class_abstract_annotation_sample_source(),
    class_abstract_annotation_sample_expected_ascii(),
    class_abstract_annotation_sample_expected_unicode(),
  )
}

///|
fn class_enum_annotation_sample_source() -> String {
  (
    #|classDiagram
    #|  class Status {
    #|    <<enumeration>>
    #|    ACTIVE
    #|    INACTIVE
    #|    PENDING
    #|    DELETED
    #|  }
  )
}

///|
fn class_enum_annotation_sample_expected_ascii() -> String {
  [
    "+-----------------+    ", "| <<enumeration>> |    ", "| Status          |    ",
    "+-----------------+    ", "| ACTIVE          |    ", "| INACTIVE        |    ",
    "| PENDING         |    ", "| DELETED         |    ", "+-----------------+    ",
    "                       ", "                       ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_enum_annotation_sample_expected_unicode() -> String {
  [
    "┌─────────────────┐    ", "│ <<enumeration>> │    ",
    "│ Status          │    ", "├─────────────────┤    ",
    "│ ACTIVE          │    ", "│ INACTIVE        │    ", "│ PENDING         │    ",
    "│ DELETED         │    ", "└─────────────────┘    ",
    "                       ", "                       ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Enum Annotation sample" {
  assert_text_parity(
    class_enum_annotation_sample_source(),
    class_enum_annotation_sample_expected_ascii(),
    class_enum_annotation_sample_expected_unicode(),
  )
}

///|
fn class_inheritance_sample_source() -> String {
  (
    #|classDiagram
    #|  class Animal {
    #|    +String name
    #|    +eat() void
    #|  }
    #|  class Dog {
    #|    +String breed
    #|    +bark() void
    #|  }
    #|  class Cat {
    #|    +bool isIndoor
    #|    +meow() void
    #|  }
    #|  Animal <|-- Dog
    #|  Animal <|-- Cat
  )
}

///|
fn class_inheritance_sample_expected_ascii() -> String {
  [
    "+---------------+                            ", "| Animal        |                            ",
    "+---------------+                            ", "| +name: String |                            ",
    "+---------------+                            ", "| +eat: void    |                            ",
    "+---------------+                            ", "        ^                                    ",
    "        ------------------------             ", "         |                     |             ",
    "+----------------+    +-----------------+    ", "| Dog            |    | Cat             |    ",
    "+----------------+    +-----------------+    ", "| +breed: String |    | +isIndoor: bool |    ",
    "+----------------+    +-----------------+    ", "| +bark: void    |    | +meow: void     |    ",
    "+----------------+    +-----------------+    ", "                                             ",
    "                                             ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_inheritance_sample_expected_unicode() -> String {
  [
    "┌───────────────┐                            ",
    "│ Animal        │                            ", "├───────────────┤                            ",
    "│ +name: String │                            ", "├───────────────┤                            ",
    "│ +eat: void    │                            ", "└───────────────┘                            ",
    "        △                                    ", "        └──────────────────────┐             ",
    "         │                     │             ", "┌────────────────┐    ┌─────────────────┐    ",
    "│ Dog            │    │ Cat             │    ", "├────────────────┤    ├─────────────────┤    ",
    "│ +breed: String │    │ +isIndoor: bool │    ", "├────────────────┤    ├─────────────────┤    ",
    "│ +bark: void    │    │ +meow: void     │    ", "└────────────────┘    └─────────────────┘    ",
    "                                             ", "                                             ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Inheritance (<|--) sample" {
  assert_text_parity(
    class_inheritance_sample_source(),
    class_inheritance_sample_expected_ascii(),
    class_inheritance_sample_expected_unicode(),
  )
}

///|
fn class_composition_sample_source() -> String {
  (
    #|classDiagram
    #|  class Car {
    #|    +String model
    #|    +start() void
    #|  }
    #|  class Engine {
    #|    +int horsepower
    #|    +rev() void
    #|  }
    #|  Car *-- Engine
  )
}

///|
fn class_composition_sample_expected_ascii() -> String {
  [
    "+----------------+      ", "| Car            |      ", "+----------------+      ",
    "| +model: String |      ", "+----------------+      ", "| +start: void   |      ",
    "+----------------+      ", "         *              ", "         --             ",
    "          |             ", "+------------------+    ", "| Engine           |    ",
    "+------------------+    ", "| +horsepower: int |    ", "+------------------+    ",
    "| +rev: void       |    ", "+------------------+    ", "                        ",
    "                        ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_composition_sample_expected_unicode() -> String {
  [
    "┌────────────────┐      ", "│ Car            │      ",
    "├────────────────┤      ", "│ +model: String │      ",
    "├────────────────┤      ", "│ +start: void   │      ",
    "└────────────────┘      ", "         ◆              ",
    "         └┐             ", "          │             ", "┌──────────────────┐    ",
    "│ Engine           │    ", "├──────────────────┤    ",
    "│ +horsepower: int │    ", "├──────────────────┤    ",
    "│ +rev: void       │    ", "└──────────────────┘    ",
    "                        ", "                        ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Composition (*--) sample" {
  assert_text_parity(
    class_composition_sample_source(),
    class_composition_sample_expected_ascii(),
    class_composition_sample_expected_unicode(),
  )
}

///|
fn class_aggregation_o_sample_source() -> String {
  (
    #|classDiagram
    #|  class University {
    #|    +String name
    #|  }
    #|  class Department {
    #|    +String faculty
    #|  }
    #|  University o-- Department
  )
}

///|
fn class_aggregation_o_sample_expected_ascii() -> String {
  [
    "+---------------+       ", "| University    |       ", "+---------------+       ",
    "| +name: String |       ", "+---------------+       ", "        o               ",
    "        ---             ", "          |             ", "+------------------+    ",
    "| Department       |    ", "+------------------+    ", "| +faculty: String |    ",
    "+------------------+    ", "                        ", "                        ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_aggregation_o_sample_expected_unicode() -> String {
  [
    "┌───────────────┐       ", "│ University    │       ",
    "├───────────────┤       ", "│ +name: String │       ",
    "└───────────────┘       ", "        ◇               ",
    "        └─┐             ", "          │             ", "┌──────────────────┐    ",
    "│ Department       │    ", "├──────────────────┤    ",
    "│ +faculty: String │    ", "└──────────────────┘    ",
    "                        ", "                        ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Aggregation (o--) sample" {
  assert_text_parity(
    class_aggregation_o_sample_source(),
    class_aggregation_o_sample_expected_ascii(),
    class_aggregation_o_sample_expected_unicode(),
  )
}

///|
fn class_association_sample_source() -> String {
  (
    #|classDiagram
    #|  class Customer {
    #|    +String name
    #|  }
    #|  class Order {
    #|    +int orderId
    #|  }
    #|  Customer --> Order
  )
}

///|
fn class_association_sample_expected_ascii() -> String {
  [
    "+---------------+    ", "| Customer      |    ", "+---------------+    ", "| +name: String |    ",
    "+---------------+    ", "        |            ", "        |            ", "        v            ",
    "+---------------+    ", "| Order         |    ", "+---------------+    ", "| +orderId: int |    ",
    "+---------------+    ", "                     ", "                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_association_sample_expected_unicode() -> String {
  [
    "┌───────────────┐    ", "│ Customer      │    ",
    "├───────────────┤    ", "│ +name: String │    ",
    "└───────────────┘    ", "        │            ",
    "        │            ", "        ▼            ", "┌───────────────┐    ",
    "│ Order         │    ", "├───────────────┤    ",
    "│ +orderId: int │    ", "└───────────────┘    ",
    "                     ", "                     ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Association (-->) sample" {
  assert_text_parity(
    class_association_sample_source(),
    class_association_sample_expected_ascii(),
    class_association_sample_expected_unicode(),
  )
}

///|
fn class_dependency_sample_source() -> String {
  (
    #|classDiagram
    #|  class Service {
    #|    +process() void
    #|  }
    #|  class Repository {
    #|    +find() Object
    #|  }
    #|  Service ..> Repository
  )
}

///|
fn class_dependency_sample_expected_ascii() -> String {
  [
    "+----------------+    ", "| Service        |    ", "+----------------+    ",
    "|                |    ", "+----------------+    ", "| +process: void |    ",
    "+----------------+    ", "         :            ", "        ..            ",
    "        v             ", "+---------------+     ", "| Repository    |     ",
    "+---------------+     ", "|               |     ", "+---------------+     ",
    "| +find: Object |     ", "+---------------+     ", "                      ",
    "                      ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_dependency_sample_expected_unicode() -> String {
  [
    "┌────────────────┐    ", "│ Service        │    ",
    "├────────────────┤    ", "│                │    ",
    "├────────────────┤    ", "│ +process: void │    ",
    "└────────────────┘    ", "         ┊            ",
    "        ┌┘            ", "        ▼             ", "┌───────────────┐     ",
    "│ Repository    │     ", "├───────────────┤     ",
    "│               │     ", "├───────────────┤     ",
    "│ +find: Object │     ", "└───────────────┘     ",
    "                      ", "                      ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Dependency (..>) sample" {
  assert_text_parity(
    class_dependency_sample_source(),
    class_dependency_sample_expected_ascii(),
    class_dependency_sample_expected_unicode(),
  )
}

///|
fn class_realization_sample_source() -> String {
  (
    #|classDiagram
    #|  class Flyable {
    #|    <<interface>>
    #|    +fly() void
    #|  }
    #|  class Bird {
    #|    +fly() void
    #|    +sing() void
    #|  }
    #|  Bird ..|> Flyable
  )
}

///|
fn class_realization_sample_expected_ascii() -> String {
  [
    "+---------------+    ", "| <<interface>> |    ", "| Flyable       |    ", "+---------------+    ",
    "|               |    ", "+---------------+    ", "| +fly: void    |    ", "+---------------+    ",
    "        ^            ", "       ..            ", "       :             ", "+-------------+      ",
    "| Bird        |      ", "+-------------+      ", "|             |      ", "+-------------+      ",
    "| +fly: void  |      ", "| +sing: void |      ", "+-------------+      ", "                     ",
    "                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_realization_sample_expected_unicode() -> String {
  [
    "┌───────────────┐    ", "│ <<interface>> │    ",
    "│ Flyable       │    ", "├───────────────┤    ",
    "│               │    ", "├───────────────┤    ",
    "│ +fly: void    │    ", "└───────────────┘    ",
    "        △            ", "       ┌┘            ", "       ┊             ",
    "┌─────────────┐      ", "│ Bird        │      ",
    "├─────────────┤      ", "│             │      ",
    "├─────────────┤      ", "│ +fly: void  │      ",
    "│ +sing: void │      ", "└─────────────┘      ",
    "                     ", "                     ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Realization (..|>) sample" {
  assert_text_parity(
    class_realization_sample_source(),
    class_realization_sample_expected_ascii(),
    class_realization_sample_expected_unicode(),
  )
}

///|
fn class_all_6_relationship_types_sample_source() -> String {
  (
    #|classDiagram
    #|  A <|-- B : inheritance
    #|  C *-- D : composition
    #|  E o-- F : aggregation
    #|  G --> H : association
    #|  I ..> J : dependency
    #|  K ..|> L : realization
  )
}

///|
fn class_all_6_relationship_types_sample_expected_ascii() -> String {
  [
    "+---+    +---+    +---+    +---+    +---+    +---+    ", "| A |    | C |    | E |    | G |    | I |    | L |    ",
    "+---+    +---+    +---+    +---+    +---+    +---+    ", "  ^        *        o        |        :        ^      ",
    "erita composit aggregat associat dependen realization ", "  |        |        |        v        v        :      ",
    "+---+    +---+    +---+    +---+    +---+    +---+    ", "| B |    | D |    | F |    | H |    | J |    | K |    ",
    "+---+    +---+    +---+    +---+    +---+    +---+    ", "                                                      ",
    "                                                      ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_all_6_relationship_types_sample_expected_unicode() -> String {
  [
    "┌───┐    ┌───┐    ┌───┐    ┌───┐    ┌───┐    ┌───┐    ",
    "│ A │    │ C │    │ E │    │ G │    │ I │    │ L │    ",
    "└───┘    └───┘    └───┘    └───┘    └───┘    └───┘    ",
    "  △        ◆        ◇        │        ┊        △      ", "erita composit aggregat associat dependen realization ",
    "  │        │        │        ▼        ▼        ┊      ", "┌───┐    ┌───┐    ┌───┐    ┌───┐    ┌───┐    ┌───┐    ",
    "│ B │    │ D │    │ F │    │ H │    │ J │    │ K │    ",
    "└───┘    └───┘    └───┘    └───┘    └───┘    └───┘    ",
    "                                                      ", "                                                      ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: All 6 Relationship Types sample" {
  assert_text_parity(
    class_all_6_relationship_types_sample_source(),
    class_all_6_relationship_types_sample_expected_ascii(),
    class_all_6_relationship_types_sample_expected_unicode(),
  )
}

///|
fn class_relationship_labels_sample_source() -> String {
  (
    #|classDiagram
    #|  class Teacher {
    #|    +String name
    #|  }
    #|  class Student {
    #|    +String name
    #|  }
    #|  class Course {
    #|    +String title
    #|  }
    #|  Teacher --> Course : teaches
    #|  Student --> Course : enrolled in
  )
}

///|
fn class_relationship_labels_sample_expected_ascii() -> String {
  [
    "+---------------+    +---------------+    ", "| Teacher       |    | Student       |    ",
    "+---------------+    +---------------+    ", "| +name: String |    | +name: String |    ",
    "+---------------+    +---------------+    ", "        |                    |            ",
    "     teac---- enrolled in ----            ", "         v                                ",
    "+----------------+                        ", "| Course         |                        ",
    "+----------------+                        ", "| +title: String |                        ",
    "+----------------+                        ", "                                          ",
    "                                          ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_relationship_labels_sample_expected_unicode() -> String {
  [
    "┌───────────────┐    ┌───────────────┐    ",
    "│ Teacher       │    │ Student       │    ", "├───────────────┤    ├───────────────┤    ",
    "│ +name: String │    │ +name: String │    ", "└───────────────┘    └───────────────┘    ",
    "        │                    │            ", "     teac┌─── enrolled in ───┘            ",
    "         ▼                                ", "┌────────────────┐                        ",
    "│ Course         │                        ", "├────────────────┤                        ",
    "│ +title: String │                        ", "└────────────────┘                        ",
    "                                          ", "                                          ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Relationship Labels sample" {
  assert_text_parity(
    class_relationship_labels_sample_source(),
    class_relationship_labels_sample_expected_ascii(),
    class_relationship_labels_sample_expected_unicode(),
  )
}

///|
fn class_design_pattern_observer_sample_source() -> String {
  (
    #|classDiagram
    #|  class Subject {
    #|    <<interface>>
    #|    +attach(Observer) void
    #|    +detach(Observer) void
    #|    +notify() void
    #|  }
    #|  class Observer {
    #|    <<interface>>
    #|    +update() void
    #|  }
    #|  class EventEmitter {
    #|    -List~Observer~ observers
    #|    +attach(Observer) void
    #|    +detach(Observer) void
    #|    +notify() void
    #|  }
    #|  class Logger {
    #|    +update() void
    #|  }
    #|  class Alerter {
    #|    +update() void
    #|  }
    #|  Subject <|.. EventEmitter
    #|  Observer <|.. Logger
    #|  Observer <|.. Alerter
    #|  EventEmitter --> Observer
  )
}

///|
fn class_design_pattern_observer_sample_expected_ascii() -> String {
  [
    "+---------------+                         ", "| <<interface>> |                         ",
    "| Subject       |                         ", "+---------------+                         ",
    "|               |                         ", "+---------------+                         ",
    "| +attach: void |                         ", "| +detach: void |                         ",
    "| +notify: void |                         ", "+---------------+                         ",
    "        ^                                 ", "        ........                          ",
    "               :                          ", "+----------------------------+            ",
    "| EventEmitter               |            ", "+----------------------------+            ",
    "| -observers: List~Observer~ |            ", "+----------------------------+            ",
    "| +attach: void              |            ", "| +detach: void              |            ",
    "| +notify: void              |            ", "+----------------------------+            ",
    "               |                          ", "        --------                          ",
    "        v                                 ", "+---------------+                         ",
    "| <<interface>> |                         ", "| Observer      |                         ",
    "+---------------+                         ", "|               |                         ",
    "+---------------+                         ", "| +update: void |                         ",
    "+---------------+                         ", "        ^                                 ",
    "        ......................            ", "        :                    :            ",
    "+---------------+    +---------------+    ", "| Logger        |    | Alerter       |    ",
    "+---------------+    +---------------+    ", "|               |    |               |    ",
    "+---------------+    +---------------+    ", "| +update: void |    | +update: void |    ",
    "+---------------+    +---------------+    ", "                                          ",
    "                                          ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_design_pattern_observer_sample_expected_unicode() -> String {
  [
    "┌───────────────┐                         ",
    "│ <<interface>> │                         ", "│ Subject       │                         ",
    "├───────────────┤                         ",
    "│               │                         ", "├───────────────┤                         ",
    "│ +attach: void │                         ", "│ +detach: void │                         ",
    "│ +notify: void │                         ", "└───────────────┘                         ",
    "        △                                 ", "        └╌╌╌╌╌╌┐                          ",
    "               ┊                          ", "┌────────────────────────────┐            ",
    "│ EventEmitter               │            ", "├────────────────────────────┤            ",
    "│ -observers: List~Observer~ │            ", "├────────────────────────────┤            ",
    "│ +attach: void              │            ", "│ +detach: void              │            ",
    "│ +notify: void              │            ", "└────────────────────────────┘            ",
    "               │                          ", "        ┌──────┘                          ",
    "        ▼                                 ", "┌───────────────┐                         ",
    "│ <<interface>> │                         ", "│ Observer      │                         ",
    "├───────────────┤                         ",
    "│               │                         ", "├───────────────┤                         ",
    "│ +update: void │                         ", "└───────────────┘                         ",
    "        △                                 ", "        └╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┐            ",
    "        ┊                    ┊            ", "┌───────────────┐    ┌───────────────┐    ",
    "│ Logger        │    │ Alerter       │    ", "├───────────────┤    ├───────────────┤    ",
    "│               │    │               │    ", "├───────────────┤    ├───────────────┤    ",
    "│ +update: void │    │ +update: void │    ", "└───────────────┘    └───────────────┘    ",
    "                                          ", "                                          ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Design Pattern — Observer sample" {
  assert_text_parity(
    class_design_pattern_observer_sample_source(),
    class_design_pattern_observer_sample_expected_ascii(),
    class_design_pattern_observer_sample_expected_unicode(),
  )
}

///|
fn class_mvc_architecture_sample_source() -> String {
  (
    #|classDiagram
    #|  class Model {
    #|    -data Map
    #|    +getData() Map
    #|    +setData(key, val) void
    #|    +notify() void
    #|  }
    #|  class View {
    #|    -model Model
    #|    +render() void
    #|    +update() void
    #|  }
    #|  class Controller {
    #|    -model Model
    #|    -view View
    #|    +handleInput(event) void
    #|    +updateModel(data) void
    #|  }
    #|  Controller --> Model : updates
    #|  Controller --> View : refreshes
    #|  View --> Model : reads
    #|  Model ..> View : notifies
  )
}

///|
fn class_mvc_architecture_sample_expected_ascii() -> String {
  [
    "+--------------------+    ", "| Controller         |    ", "+--------------------+    ",
    "| -Model: model      |    ", "| -View: view        |    ", "+--------------------+    ",
    "| +handleInput: void |    ", "| +updateModel: void |    ", "+--------------------+    ",
    "           |              ", "       upda|es            ", "         v |              ",
    "+----------|-----+        ", "| Model    |     |        ", "+----------|-----+        ",
    "| -Map: dat|     |        ", "+--- refreshes --+        ", "| +getDa|a: Map  |        ",
    "| +setDa|a: void |        ", "| +notif|: void  |        ", "+-------|--------+        ",
    "        |:                ", "    notifies              ", "        v                 ",
    "+---------------+         ", "| View          |         ", "+---------------+         ",
    "| -Model: model |         ", "+---------------+         ", "| +render: void |         ",
    "| +update: void |         ", "+---------------+         ", "                          ",
    "                          ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_mvc_architecture_sample_expected_unicode() -> String {
  [
    "┌────────────────────┐    ", "│ Controller         │    ",
    "├────────────────────┤    ", "│ -Model: model      │    ",
    "│ -View: view        │    ", "├────────────────────┤    ",
    "│ +handleInput: void │    ", "│ +updateModel: void │    ", "└────────────────────┘    ",
    "           │              ", "       upda│es            ", "         ▼ │              ",
    "┌──────────│─────┐        ", "│ Model    │     │        ",
    "├──────────│─────┤        ", "│ -Map: dat│     │        ",
    "├─── refreshes ──┤        ", "│ +getDa│a: Map  │        ",
    "│ +setDa│a: void │        ", "│ +notif│: void  │        ", "└───────│────────┘        ",
    "        │┊                ", "    notifies              ", "        ▼                 ",
    "┌───────────────┐         ", "│ View          │         ",
    "├───────────────┤         ", "│ -Model: model │         ",
    "├───────────────┤         ", "│ +render: void │         ",
    "│ +update: void │         ", "└───────────────┘         ",
    "                          ", "                          ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: MVC Architecture sample" {
  assert_text_parity(
    class_mvc_architecture_sample_source(),
    class_mvc_architecture_sample_expected_ascii(),
    class_mvc_architecture_sample_expected_unicode(),
  )
}

///|
fn class_full_hierarchy_sample_source() -> String {
  (
    #|classDiagram
    #|  class Animal {
    #|    <<abstract>>
    #|    +String name
    #|    +int age
    #|    +eat() void
    #|    +sleep() void
    #|  }
    #|  class Mammal {
    #|    +bool warmBlooded
    #|    +nurse() void
    #|  }
    #|  class Bird {
    #|    +bool canFly
    #|    +layEggs() void
    #|  }
    #|  class Dog {
    #|    +String breed
    #|    +bark() void
    #|  }
    #|  class Cat {
    #|    +bool isIndoor
    #|    +purr() void
    #|  }
    #|  class Parrot {
    #|    +String vocabulary
    #|    +speak() void
    #|  }
    #|  Animal <|-- Mammal
    #|  Animal <|-- Bird
    #|  Mammal <|-- Dog
    #|  Mammal <|-- Cat
    #|  Bird <|-- Parrot
  )
}

///|
fn class_full_hierarchy_sample_expected_ascii() -> String {
  [
    "+---------------+                                                       ", "| <<abstract>>  |                                                       ",
    "| Animal        |                                                       ", "+---------------+                                                       ",
    "| +name: String |                                                       ", "| +age: int     |                                                       ",
    "+---------------+                                                       ", "| +eat: void    |                                                       ",
    "| +sleep: void  |                                                       ", "+---------------+                                                       ",
    "        ^                                                               ", "        ----------------------------                                    ",
    "           |                       |                                    ", "+--------------------+    +----------------+                            ",
    "| Mammal             |    | Bird           |                            ", "+--------------------+    +----------------+                            ",
    "| +warmBlooded: bool |    | +canFly: bool  |                            ", "+--------------------+    +----------------+                            ",
    "| +nurse: void       |    | +layEggs: void |                            ", "+--------------------+    +----------------+                            ",
    "           ^                       ^                                    ", "         -----------------------   ----------------------               ",
    "         |                     |                        |               ", "+----------------+    +-----------------+    +---------------------+    ",
    "| Dog            |    | Cat             |    | Parrot              |    ", "+----------------+    +-----------------+    +---------------------+    ",
    "| +breed: String |    | +isIndoor: bool |    | +vocabulary: String |    ", "+----------------+    +-----------------+    +---------------------+    ",
    "| +bark: void    |    | +purr: void     |    | +speak: void        |    ", "+----------------+    +-----------------+    +---------------------+    ",
    "                                                                        ", "                                                                        ",
  ]
  .iter()
  .join("\n")
}

///|
fn class_full_hierarchy_sample_expected_unicode() -> String {
  [
    "┌───────────────┐                                                       ",
    "│ <<abstract>>  │                                                       ",
    "│ Animal        │                                                       ",
    "├───────────────┤                                                       ",
    "│ +name: String │                                                       ",
    "│ +age: int     │                                                       ",
    "├───────────────┤                                                       ",
    "│ +eat: void    │                                                       ",
    "│ +sleep: void  │                                                       ",
    "└───────────────┘                                                       ",
    "        △                                                               ",
    "        └──────────────────────────┐                                    ",
    "           │                       │                                    ",
    "┌────────────────────┐    ┌────────────────┐                            ",
    "│ Mammal             │    │ Bird           │                            ",
    "├────────────────────┤    ├────────────────┤                            ",
    "│ +warmBlooded: bool │    │ +canFly: bool  │                            ",
    "├────────────────────┤    ├────────────────┤                            ",
    "│ +nurse: void       │    │ +layEggs: void │                            ",
    "└────────────────────┘    └────────────────┘                            ",
    "           △                       △                                    ",
    "         ┌─└───────────────────┐   └────────────────────┐               ",
    "         │                     │                        │               ",
    "┌────────────────┐    ┌─────────────────┐    ┌─────────────────────┐    ",
    "│ Dog            │    │ Cat             │    │ Parrot              │    ",
    "├────────────────┤    ├─────────────────┤    ├─────────────────────┤    ",
    "│ +breed: String │    │ +isIndoor: bool │    │ +vocabulary: String │    ",
    "├────────────────┤    ├─────────────────┤    ├─────────────────────┤    ",
    "│ +bark: void    │    │ +purr: void     │    │ +speak: void        │    ",
    "└────────────────┘    └─────────────────┘    └─────────────────────┘    ",
    "                                                                        ", "                                                                        ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: Class: Full Hierarchy sample" {
  assert_text_parity(
    class_full_hierarchy_sample_source(),
    class_full_hierarchy_sample_expected_ascii(),
    class_full_hierarchy_sample_expected_unicode(),
  )
}

///|
fn er_basic_relationship_sample_source() -> String {
  (
    #|erDiagram
    #|  CUSTOMER ||--o{ ORDER : places
  )
}

///|
fn er_basic_relationship_sample_expected_ascii() -> String {
  [
    "+----------+places+-------+    ", "| CUSTOMER |||--o{| ORDER |    ", "+----------+      +-------+    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_basic_relationship_sample_expected_unicode() -> String {
  [
    "┌──────────┐places┌───────┐    ",
    "│ CUSTOMER │║───o╟│ ORDER │    ", "└──────────┘      └───────┘    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Basic Relationship sample" {
  assert_text_parity(
    er_basic_relationship_sample_source(),
    er_basic_relationship_sample_expected_ascii(),
    er_basic_relationship_sample_expected_unicode(),
  )
}

///|
fn er_entity_with_attributes_sample_source() -> String {
  (
    #|erDiagram
    #|  CUSTOMER {
    #|    int id PK
    #|    string name
    #|    string email UK
    #|    date created_at
    #|  }
  )
}

///|
fn er_entity_with_attributes_sample_expected_ascii() -> String {
  [
    "+--------------------+    ", "| CUSTOMER           |    ", "+--------------------+    ",
    "| PK int id          |    ", "|    string name     |    ", "| UK string email    |    ",
    "|    date created_at |    ", "+--------------------+    ", "                          ",
    "                          ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_entity_with_attributes_sample_expected_unicode() -> String {
  [
    "┌────────────────────┐    ", "│ CUSTOMER           │    ",
    "├────────────────────┤    ", "│ PK int id          │    ",
    "│    string name     │    ", "│ UK string email    │    ", "│    date created_at │    ",
    "└────────────────────┘    ", "                          ",
    "                          ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Entity with Attributes sample" {
  assert_text_parity(
    er_entity_with_attributes_sample_source(),
    er_entity_with_attributes_sample_expected_ascii(),
    er_entity_with_attributes_sample_expected_unicode(),
  )
}

///|
fn er_attribute_keys_pk_fk_uk_sample_source() -> String {
  (
    #|erDiagram
    #|  ORDER {
    #|    int id PK
    #|    int customer_id FK
    #|    string invoice_number UK
    #|    decimal total
    #|    date order_date
    #|    string status
    #|  }
  )
}

///|
fn er_attribute_keys_pk_fk_uk_sample_expected_ascii() -> String {
  [
    "+--------------------------+    ", "| ORDER                    |    ", "+--------------------------+    ",
    "| PK int id                |    ", "| FK int customer_id       |    ", "| UK string invoice_number |    ",
    "|    decimal total         |    ", "|    date order_date       |    ", "|    string status         |    ",
    "+--------------------------+    ", "                                ", "                                ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_attribute_keys_pk_fk_uk_sample_expected_unicode() -> String {
  [
    "┌──────────────────────────┐    ",
    "│ ORDER                    │    ", "├──────────────────────────┤    ",
    "│ PK int id                │    ", "│ FK int customer_id       │    ",
    "│ UK string invoice_number │    ", "│    decimal total         │    ",
    "│    date order_date       │    ", "│    string status         │    ",
    "└──────────────────────────┘    ",
    "                                ", "                                ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Attribute Keys (PK, FK, UK) sample" {
  assert_text_parity(
    er_attribute_keys_pk_fk_uk_sample_source(),
    er_attribute_keys_pk_fk_uk_sample_expected_ascii(),
    er_attribute_keys_pk_fk_uk_sample_expected_unicode(),
  )
}

///|
fn er_exactly_one_to_exactly_one_sample_source() -> String {
  (
    #|erDiagram
    #|  PERSON ||--|| PASSPORT : has
  )
}

///|
fn er_exactly_one_to_exactly_one_sample_expected_ascii() -> String {
  [
    "+--------+ has  +----------+    ", "| PERSON |||--||| PASSPORT |    ", "+--------+      +----------+    ",
    "                                ", "                                ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_exactly_one_to_exactly_one_sample_expected_unicode() -> String {
  [
    "┌────────┐ has  ┌──────────┐    ",
    "│ PERSON │║────║│ PASSPORT │    ", "└────────┘      └──────────┘    ",
    "                                ", "                                ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Exactly One to Exactly One (||--||) sample" {
  assert_text_parity(
    er_exactly_one_to_exactly_one_sample_source(),
    er_exactly_one_to_exactly_one_sample_expected_ascii(),
    er_exactly_one_to_exactly_one_sample_expected_unicode(),
  )
}

///|
fn er_exactly_one_to_zero_or_many_o_sample_source() -> String {
  (
    #|erDiagram
    #|  CUSTOMER ||--o{ ORDER : places
  )
}

///|
fn er_exactly_one_to_zero_or_many_o_sample_expected_ascii() -> String {
  [
    "+----------+places+-------+    ", "| CUSTOMER |||--o{| ORDER |    ", "+----------+      +-------+    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_exactly_one_to_zero_or_many_o_sample_expected_unicode() -> String {
  [
    "┌──────────┐places┌───────┐    ",
    "│ CUSTOMER │║───o╟│ ORDER │    ", "└──────────┘      └───────┘    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Exactly One to Zero-or-Many (||--o{) sample" {
  assert_text_parity(
    er_exactly_one_to_zero_or_many_o_sample_source(),
    er_exactly_one_to_zero_or_many_o_sample_expected_ascii(),
    er_exactly_one_to_zero_or_many_o_sample_expected_unicode(),
  )
}

///|
fn er_zero_or_one_to_one_or_many_o_sample_source() -> String {
  (
    #|erDiagram
    #|  SUPERVISOR |o--|{ EMPLOYEE : manages
  )
}

///|
fn er_zero_or_one_to_one_or_many_o_sample_expected_ascii() -> String {
  [
    "+------------+manage+----------+    ", "| SUPERVISOR |o|--}|| EMPLOYEE |    ",
    "+------------+      +----------+    ", "                                    ",
    "                                    ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_zero_or_one_to_one_or_many_o_sample_expected_unicode() -> String {
  [
    "┌────────────┐manage┌──────────┐    ",
    "│ SUPERVISOR │o║───╟│ EMPLOYEE │    ", "└────────────┘      └──────────┘    ",
    "                                    ", "                                    ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Zero-or-One to One-or-Many (|o--|{) sample" {
  assert_text_parity(
    er_zero_or_one_to_one_or_many_o_sample_source(),
    er_zero_or_one_to_one_or_many_o_sample_expected_ascii(),
    er_zero_or_one_to_one_or_many_o_sample_expected_unicode(),
  )
}

///|
fn er_one_or_more_to_zero_or_many_o_sample_source() -> String {
  (
    #|erDiagram
    #|  TEACHER }|--o{ COURSE : teaches
  )
}

///|
fn er_one_or_more_to_zero_or_many_o_sample_expected_ascii() -> String {
  [
    "+---------+teache+--------+    ", "| TEACHER |}|--o{| COURSE |    ", "+---------+      +--------+    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_one_or_more_to_zero_or_many_o_sample_expected_unicode() -> String {
  [
    "┌─────────┐teache┌────────┐    ",
    "│ TEACHER │╟───o╟│ COURSE │    ", "└─────────┘      └────────┘    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: One-or-More to Zero-or-Many (}|--o{) sample" {
  assert_text_parity(
    er_one_or_more_to_zero_or_many_o_sample_source(),
    er_one_or_more_to_zero_or_many_o_sample_expected_ascii(),
    er_one_or_more_to_zero_or_many_o_sample_expected_unicode(),
  )
}

///|
fn er_all_cardinality_types_sample_source() -> String {
  (
    #|erDiagram
    #|  A ||--|| B : one-to-one
    #|  C ||--o{ D : one-to-many
    #|  E |o--|{ F : opt-to-many
    #|  G }|--o{ H : many-to-many
  )
}

///|
fn er_all_cardinality_types_sample_expected_ascii() -> String {
  [
    "+---+one-to+---+      +---+           ", "| A |||--||| B |      | C |           ",
    "+---+      +---+      +---+           ", "                       ||             ",
    "  ----------------------- one-to-many ", "  |                     |             ",
    " o{                     |             ", "+---+      +---+opt-to+---+           ",
    "| D |      | E |o|--}|| F |           ", "+---+      +---+      +---+           ",
    "                                      ", "                                      ",
    "                                      ", "                                      ",
    "+---+many-t+---+                      ", "| G |}|--o{| H |                      ",
    "+---+      +---+                      ", "                                      ",
    "                                      ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_all_cardinality_types_sample_expected_unicode() -> String {
  [
    "┌───┐one-to┌───┐      ┌───┐           ", "│ A │║────║│ B │      │ C │           ",
    "└───┘      └───┘      └───┘           ", "                        ║             ",
    "  ─────────────────────── one-to-many ",
    "  │                     │             ", " o╟                     │             ",
    "┌───┐      ┌───┐opt-to┌───┐           ", "│ D │      │ E │o║───╟│ F │           ",
    "└───┘      └───┘      └───┘           ", "                                      ",
    "                                      ", "                                      ",
    "                                      ", "┌───┐many-t┌───┐                      ",
    "│ G │╟───o╟│ H │                      ", "└───┘      └───┘                      ",
    "                                      ", "                                      ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: All Cardinality Types sample" {
  assert_text_parity(
    er_all_cardinality_types_sample_source(),
    er_all_cardinality_types_sample_expected_ascii(),
    er_all_cardinality_types_sample_expected_unicode(),
  )
}

///|
fn er_identifying_solid_relationship_sample_source() -> String {
  (
    #|erDiagram
    #|  ORDER ||--|{ LINE_ITEM : contains
  )
}

///|
fn er_identifying_solid_relationship_sample_expected_ascii() -> String {
  [
    "+-------+contai+-----------+    ", "| ORDER |||--}|| LINE_ITEM |    ", "+-------+      +-----------+    ",
    "                                ", "                                ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_identifying_solid_relationship_sample_expected_unicode() -> String {
  [
    "┌───────┐contai┌───────────┐    ",
    "│ ORDER │║────╟│ LINE_ITEM │    ", "└───────┘      └───────────┘    ",
    "                                ", "                                ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Identifying (Solid) Relationship sample" {
  assert_text_parity(
    er_identifying_solid_relationship_sample_source(),
    er_identifying_solid_relationship_sample_expected_ascii(),
    er_identifying_solid_relationship_sample_expected_unicode(),
  )
}

///|
fn er_non_identifying_dashed_relationship_sample_source() -> String {
  (
    #|erDiagram
    #|  USER ||..o{ LOG_ENTRY : generates
    #|  USER ||..o{ SESSION : opens
  )
}

///|
fn er_non_identifying_dashed_relationship_sample_expected_ascii() -> String {
  [
    "+------+genera+-----------+    ", "| USER |||..o{| LOG_ENTRY |    ", "+------+      +-----------+    ",
    "   ||                          ", "    ..opens                    ", "    ::                         ",
    "    o{                         ", "+---------+                    ", "| SESSION |                    ",
    "+---------+                    ", "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_non_identifying_dashed_relationship_sample_expected_unicode() -> String {
  [
    "┌──────┐genera┌───────────┐    ",
    "│ USER │║╌╌╌o╟│ LOG_ENTRY │    ", "└──────┘      └───────────┘    ",
    "    ║                          ", "    ╌╌opens                    ", "    ┊┊                         ",
    "    o╟                         ", "┌─────────┐                    ",
    "│ SESSION │                    ", "└─────────┘                    ",
    "                               ", "                               ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Non-Identifying (Dashed) Relationship sample" {
  assert_text_parity(
    er_non_identifying_dashed_relationship_sample_source(),
    er_non_identifying_dashed_relationship_sample_expected_ascii(),
    er_non_identifying_dashed_relationship_sample_expected_unicode(),
  )
}

///|
fn er_mixed_identifying_non_identifying_sample_source() -> String {
  (
    #|erDiagram
    #|  ORDER ||--|{ LINE_ITEM : contains
    #|  ORDER ||..o{ SHIPMENT : ships-via
    #|  PRODUCT ||--o{ LINE_ITEM : includes
    #|  PRODUCT ||..o{ REVIEW : receives
  )
}

///|
fn er_mixed_identifying_non_identifying_sample_expected_ascii() -> String {
  [
    "+-------+contai+-ships-via-+      +----------+    ", "| ORDER |||.....................o{| SHIPMENT |    ",
    "+-------+      +-----------+      +----------+    ", "                    o{                            ",
    "     ----------------- includes                   ", "     |               |                            ",
    "    ||               |                            ", "+---------+receiv+--------+                       ",
    "| PRODUCT |||..o{| REVIEW |                       ", "+---------+      +--------+                       ",
    "                                                  ", "                                                  ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_mixed_identifying_non_identifying_sample_expected_unicode() -> String {
  [
    "┌───────┐contai┌─ships-via─┐      ┌──────────┐    ",
    "│ ORDER │║╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌o╟│ SHIPMENT │    ",
    "└───────┘      └───────────┘      └──────────┘    ",
    "                    o╟                            ", "     ───────────────── includes                   ",
    "     │               │                            ", "     ║               │                            ",
    "┌─────────┐receiv┌────────┐                       ",
    "│ PRODUCT │║╌╌╌o╟│ REVIEW │                       ", "└─────────┘      └────────┘                       ",
    "                                                  ", "                                                  ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Mixed Identifying & Non-Identifying sample" {
  assert_text_parity(
    er_mixed_identifying_non_identifying_sample_source(),
    er_mixed_identifying_non_identifying_sample_expected_ascii(),
    er_mixed_identifying_non_identifying_sample_expected_unicode(),
  )
}

///|
fn er_e_commerce_schema_sample_source() -> String {
  (
    #|erDiagram
    #|  CUSTOMER {
    #|    int id PK
    #|    string name
    #|    string email UK
    #|  }
    #|  ORDER {
    #|    int id PK
    #|    date created
    #|    int customer_id FK
    #|  }
    #|  PRODUCT {
    #|    int id PK
    #|    string name
    #|    float price
    #|  }
    #|  LINE_ITEM {
    #|    int id PK
    #|    int order_id FK
    #|    int product_id FK
    #|    int quantity
    #|  }
    #|  CUSTOMER ||--o{ ORDER : places
    #|  ORDER ||--|{ LINE_ITEM : contains
    #|  PRODUCT ||--o{ LINE_ITEM : includes
  )
}

///|
fn er_e_commerce_schema_sample_expected_ascii() -> String {
  [
    "+-----------------+      +--------------------+    ", "| CUSTOMER        |      | ORDER              |    ",
    "+-----------------+places+--------------------+    ", "| PK int id       |||--o{| PK int id          |    ",
    "|    string name  |      |    date created    |    ", "| UK string email |      | FK int customer_id |    ",
    "+-----------------+      +--------------------+    ", "                                   ||              ",
    "                                  --- contains     ", "                                  | |              ",
    "                                 }| |              ", "+----------------+      +-------------------+      ",
    "| PRODUCT        |      | LINE_ITEM         |      ", "+----------------+includ+-------------------+      ",
    "| PK int id      |||--o{| PK int id         |      ", "|    string name |      | FK int order_id   |      ",
    "|    float price |      | FK int product_id |      ", "+----------------+      |    int quantity   |      ",
    "                        +-------------------+      ", "                                                   ",
    "                                                   ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_e_commerce_schema_sample_expected_unicode() -> String {
  [
    "┌─────────────────┐      ┌────────────────────┐    ",
    "│ CUSTOMER        │      │ ORDER              │    ", "├─────────────────┤places├────────────────────┤    ",
    "│ PK int id       │║───o╟│ PK int id          │    ", "│    string name  │      │    date created    │    ",
    "│ UK string email │      │ FK int customer_id │    ", "└─────────────────┘      └────────────────────┘    ",
    "                                    ║              ", "                                  ─── contains     ",
    "                                  │ │              ", "                                  ╟ │              ",
    "┌────────────────┐      ┌───────────────────┐      ",
    "│ PRODUCT        │      │ LINE_ITEM         │      ", "├────────────────┤includ├───────────────────┤      ",
    "│ PK int id      │║───o╟│ PK int id         │      ", "│    string name │      │ FK int order_id   │      ",
    "│    float price │      │ FK int product_id │      ", "└────────────────┘      │    int quantity   │      ",
    "                        └───────────────────┘      ",
    "                                                   ", "                                                   ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: E-Commerce Schema sample" {
  assert_text_parity(
    er_e_commerce_schema_sample_source(),
    er_e_commerce_schema_sample_expected_ascii(),
    er_e_commerce_schema_sample_expected_unicode(),
  )
}

///|
fn er_blog_platform_schema_sample_source() -> String {
  (
    #|erDiagram
    #|  USER {
    #|    int id PK
    #|    string username UK
    #|    string email UK
    #|    date joined
    #|  }
    #|  POST {
    #|    int id PK
    #|    string title
    #|    text content
    #|    int author_id FK
    #|    date published
    #|  }
    #|  COMMENT {
    #|    int id PK
    #|    text body
    #|    int post_id FK
    #|    int user_id FK
    #|    date created
    #|  }
    #|  TAG {
    #|    int id PK
    #|    string name UK
    #|  }
    #|  USER ||--o{ POST : writes
    #|  USER ||--o{ COMMENT : authors
    #|  POST ||--o{ COMMENT : has
    #|  POST }|--o{ TAG : tagged-with
  )
}

///|
fn er_blog_platform_schema_sample_expected_ascii() -> String {
  [
    "+--------------------+      +-------------------+    ", "| USER               |      | POST              |    ",
    "+--------------------+      +-------------------+    ", "| PK int id          |writes| PK int id         |    ",
    "| UK string username |||--o{|    string title   |    ", "| UK string email    |      |    text content   |    ",
    "|    date joined     |      | FK int author_id  |    ", "+--------------------+      |    date published |    ",
    "          ||                +-------------------+    ", "           |                         }|              ",
    "         ------------------------------ tagged-with  ", "         | |                      |   |              ",
    "        o{ |                     o{   |              ", "+-----------------+      +----------------+          ",
    "| COMMENT         |      | TAG            |          ", "+-----------------+      +----------------+          ",
    "| PK int id       |      | PK int id      |          ", "|    text body    |      | UK string name |          ",
    "| FK int post_id  |      +----------------+          ", "| FK int user_id  |                                  ",
    "|    date created |                                  ", "+-----------------+                                  ",
    "                                                     ", "                                                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_blog_platform_schema_sample_expected_unicode() -> String {
  [
    "┌────────────────────┐      ┌───────────────────┐    ",
    "│ USER               │      │ POST              │    ", "├────────────────────┤      ├───────────────────┤    ",
    "│ PK int id          │writes│ PK int id         │    ", "│ UK string username │║───o╟│    string title   │    ",
    "│ UK string email    │      │    text content   │    ", "│    date joined     │      │ FK int author_id  │    ",
    "└────────────────────┘      │    date published │    ",
    "           ║                └───────────────────┘    ",
    "           │                          ╟              ", "         ────────────────────────────── tagged-with  ",
    "         │ │                      │   │              ", "        o╟ │                     o╟   │              ",
    "┌─────────────────┐      ┌────────────────┐          ",
    "│ COMMENT         │      │ TAG            │          ", "├─────────────────┤      ├────────────────┤          ",
    "│ PK int id       │      │ PK int id      │          ", "│    text body    │      │ UK string name │          ",
    "│ FK int post_id  │      └────────────────┘          ",
    "│ FK int user_id  │                                  ", "│    date created │                                  ",
    "└─────────────────┘                                  ",
    "                                                     ", "                                                     ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: Blog Platform Schema sample" {
  assert_text_parity(
    er_blog_platform_schema_sample_source(),
    er_blog_platform_schema_sample_expected_ascii(),
    er_blog_platform_schema_sample_expected_unicode(),
  )
}

///|
fn er_school_management_schema_sample_source() -> String {
  (
    #|erDiagram
    #|  STUDENT {
    #|    int id PK
    #|    string name
    #|    date dob
    #|    string grade
    #|  }
    #|  TEACHER {
    #|    int id PK
    #|    string name
    #|    string department
    #|  }
    #|  COURSE {
    #|    int id PK
    #|    string title
    #|    int teacher_id FK
    #|    int credits
    #|  }
    #|  ENROLLMENT {
    #|    int id PK
    #|    int student_id FK
    #|    int course_id FK
    #|    string semester
    #|    float grade
    #|  }
    #|  TEACHER ||--o{ COURSE : teaches
    #|  STUDENT ||--o{ ENROLLMENT : enrolled
    #|  COURSE ||--o{ ENROLLMENT : has
  )
}

///|
fn er_school_management_schema_sample_expected_ascii() -> String {
  [
    "+-----------------+      +----------------------+    ", "| STUDENT         |      | TEACHER              |    ",
    "+-----------------+      +----------------------+    ", "| PK int id       |      | PK int id            |    ",
    "|    string name  |      |    string name       |    ", "|    date dob     |      |    string department |    ",
    "|    string grade |      +----------------------+    ", "+-----------------+                 ||               ",
    "        ||                           |               ", "         --enrolled--------------------teaches       ",
    "         ||                          ||              ", "         |{                          o{              ",
    "+-------------------+      +--------------------+    ", "| COURSE            |      | ENROLLMENT         |    ",
    "+-------------------+      +--------------------+    ", "| PK int id         | has  | PK int id          |    ",
    "|    string title   |||--o{| FK int student_id  |    ", "| FK int teacher_id |      | FK int course_id   |    ",
    "|    int credits    |      |    string semester |    ", "+-------------------+      |    float grade     |    ",
    "                           +--------------------+    ", "                                                     ",
    "                                                     ",
  ]
  .iter()
  .join("\n")
}

///|
fn er_school_management_schema_sample_expected_unicode() -> String {
  [
    "┌─────────────────┐      ┌──────────────────────┐    ",
    "│ STUDENT         │      │ TEACHER              │    ", "├─────────────────┤      ├──────────────────────┤    ",
    "│ PK int id       │      │ PK int id            │    ", "│    string name  │      │    string name       │    ",
    "│    date dob     │      │    string department │    ", "│    string grade │      └──────────────────────┘    ",
    "└─────────────────┘                  ║               ",
    "         ║                           │               ", "         ──enrolled────────────────────teaches       ",
    "         ││                          ││              ", "         │╟                          o╟              ",
    "┌───────────────────┐      ┌────────────────────┐    ",
    "│ COURSE            │      │ ENROLLMENT         │    ", "├───────────────────┤      ├────────────────────┤    ",
    "│ PK int id         │ has  │ PK int id          │    ", "│    string title   │║───o╟│ FK int student_id  │    ",
    "│ FK int teacher_id │      │ FK int course_id   │    ", "│    int credits    │      │    string semester │    ",
    "└───────────────────┘      │    float grade     │    ",
    "                           └────────────────────┘    ",
    "                                                     ", "                                                     ",
  ]
  .iter()
  .join("\n")
}

///|
test "ASCII/Unicode parity regression: ER: School Management Schema sample" {
  assert_text_parity(
    er_school_management_schema_sample_source(),
    er_school_management_schema_sample_expected_ascii(),
    er_school_management_schema_sample_expected_unicode(),
  )
}
